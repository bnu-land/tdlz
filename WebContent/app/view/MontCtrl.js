/*
 * File: app/view/MontCtrl.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.MontCtrl', {
    extend: 'Ext.container.Container',
    alias: 'widget.MontCtrl',
    layout: {
    	type: 'card'
    },
    id: 'MontCtrl',
    autoScroll: true,

    initComponent: function() {
        var me = this;
        mapStore = Ext.create('Ext.data.Store', {
        	id: 'mapStore',
    	    proxy: {
    	        // load using HTTP
    	        type: 'ajax',
    	        url: 'showMap.action',  
    	        // the return will be XML, so lets set up a reader
    	        reader:{
        			type:"json",
        			root:"results",
        			totalProperty :'totalCount'		
        		},
        		actionMethods: {  
                    read: 'POST'  
                },
        		writer:{
        			type:"json"
        		}
    	    },
            fields: [
		        {name: 'data',  type: 'auto'},  
         	]   	    
    	});

        mapStore.load();
        
        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'container',
                    id: 'spatialMont',
                    layout: 'border',
                    items: [
                        {
                            xtype: 'panel',
                            id: 'mapMOnt',
                            region: 'center',
                            title: '拆迁过程监控',
                            html: '<div id="warmMap" class="warmMapClass" style="width:100%;height:100%"></div>',
                        },
                        {
                        	
                            xtype: 'panel',
                  
                            title: '工具',
                            width: 200,
                            height: 100,
                            layout: {
                            	type: 'vbox'
                            },
                    
                            region: 'east',
                            collapsed: true,
                            collapsible: true,
                            items: [
                                {
                                	xtype: 'button',
                                	x: 1,
 	                                y: 160,
 	                                width: 70,
                                	text: '缩小',
                                	listeners: {
                                		click: {
                                			fn: me.onZoomOut,
                                			scope: me
                                		}
                                	}
                                }, 
                                {
                                	xtype: 'button',
                                	text: '放大',
                                	x: 1,
 	                                y: 160,
 	                                width: 70,
                                	listeners: {
                                		click: {
                                			fn: me.onZoomIn,
                                			scope: me
                                		}
                                	}
                                },
                                {
                                	xtype: 'button',
                                	text: '全范围显示',
                                	x: 1,
 	                                y: 160,
 	                                width: 70,
                                	listeners: {
                                		click: {
                                			fn: me.onExtent,
                                			scope: me
                                		}
                                	}
                                },
                                {
                                	xtype: 'button',
                                	text: '取消选择',
                                	x: 1,
 	                                y: 160,
 	                                width: 70,
                                	listeners: {
                                		click: {
                                			fn: me.onCancel,
                                			scope: me
                                		}
                                	}
                                },
                                {
                                	xtype: 'button',
                                	text: '显示地块属性',
                                	x: 1,
 	                                y: 160,
 	                                width: 70,
                                	listeners: {
                                		click: {
                                			fn: me.onShowCard,
                                			scope: me
                                		}
                                	}
                                },
                            ]
                        }
                    ]
                },
                {
                	xtype: 'tabpanel',
                	 height: 476,
                     id: 'allMontBC',
                     width: 764,
                     fixed: true,
                     activeTab: 0,
                     plain: true,
                     listeners: {
                         
                         tabchange: {
                             fn: me.onTabChangeBC,
                             scope: me
                         }
                     },
                     items: 
                    	 [
							{
							    xtype: 'gridpanel',
							    id: 'montBC',
							    title: '补偿监测',
							    store: 'montBC',
							    columns: [
									{
									    xtype: 'gridcolumn',
									    id: 'numBcProjectID',
									    width: 74,
									    dataIndex: 'farmer.projectID',
									    text: '项目编号'
									},
							        {
							            xtype: 'gridcolumn',
							            id: 'numBcPk',
							            width: 74,
							            dataIndex: 'card',
							            text: '身份证'
							        },
							        {
							            xtype: 'gridcolumn',
							            id: 'namefarmerBC',
							            width: 62,
							            dataIndex: 'name',
							            text: '农户姓名'
							        },
							        {
							        	xtype: 'gridcolumn',
							            id: 'farmerPhoneBC',
							            width: 62,
							            dataIndex: 'phone',
							            text: '农户电话'
							        },
							        {
							            xtype: 'gridcolumn',
							            text: '宅基地',
							            columns: [
							                {
							                    xtype: 'gridcolumn',
							                    id: 'areaZBC',
							                    dataIndex: 'area',
							                    text: '面积'
							                },
							                {
							                    xtype: 'gridcolumn',
							                    id: 'moneyZBC',
							                    dataIndex: 'totalMoney',
							                    text: '金额'
							                }
							            ]
							        },						 
							        {
							            xtype: 'gridcolumn',
							            width: 299,
							            text: '补偿金第一次发放情况',
							            columns: [
							                {
							                    xtype: 'datecolumn',
							                    id: 'date1BC',
							                    dataIndex: 'firstMoneyDate',
							                    text: '日期'
							                },
							                {
							                    xtype: 'gridcolumn',
							                    id: 'money1BC',
							                    dataIndex: 'firstMoney',
							                    text: '补偿金额'
							                },
							                {
							                    xtype: 'actioncolumn',
							                    width: 70,
							                    layout: {
							                        type: 'fit'
							                    },
							                    suspendLayout: true,
							                    items: [
							                        {
							                        	handler: function(view, rowIndex, colIndex, item, e, record, row) {
							                        		
							                        		jsID = record.get("id");
							                        		jsID = jsID + "," + "1";
							                            	window.location.href = "downHZD.action?id="+jsID+"";
					                                    },
							                            disabled: false,
							                            icon: 'img/check.png',
							                        }
							                    ]
							                }
							            ]
							        },
							        {
							            xtype: 'gridcolumn',
							            width: 294,
							            text: '补偿金第二次发放情况',
							            columns: [
							                {
							                    xtype: 'datecolumn',
							                    id: 'date2BC',
							                    dataIndex: 'secondMoneyDate',
							                    text: '日期',
							                },
							                {
							                    xtype: 'gridcolumn',
							                    id: 'money2BC',
							                    dataIndex: 'secondMoney',
							                    text: '补偿金额',
							                },
							                {
							                    xtype: 'actioncolumn',
							                    width: 70,
							                    layout: {
							                        type: 'fit',
							                    },
							                    suspendLayout: true,
							                    items: [
							                        {

					                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
					                                    	
					                                    	jsID = record.get("id");
							                        		jsID = jsID + "," + "2";
							                            	window.location.href = "downHZD.action?path="+jsPath+"";
					                                    },
							                            altText: 'check',
							                            icon: 'img/check.png',
							                            iconCls: ''
							                        }
							                    ]
							                }
							            ]
							        }
							    ],
							    viewConfig: {
							        listeners: {
							            itemclick: {
							                fn: me.onViewItemClick,
							                scope: me
							            }
							        }
							    }
							},
							{
							    xtype: 'gridpanel',
							    id: 'montBCN',
							    title: '补偿监测（回执单未上传）',
							    store: 'montBC',
							    columns: [
									{
									    xtype: 'gridcolumn',
									    id: 'numBcProjectIDN',
									    width: 74,
									    dataIndex: 'farmer.projectID',
									    text: '项目编号'
									},
							        {
							            xtype: 'gridcolumn',
							            id: 'numBcPkN',
							            width: 74,
							            dataIndex: 'card',
							            text: '身份证'
							        },
							        {
							            xtype: 'gridcolumn',
							            id: 'namefarmerBCN',
							            width: 62,
							            dataIndex: 'name',
							            text: '农户姓名'
							        },
							        {
							        	xtype: 'gridcolumn',
							            id: 'farmerPhoneBCN',
							            width: 62,
							            dataIndex: 'phone',
							            text: '农户电话'
							        },
							        {
							            xtype: 'gridcolumn',
							            text: '宅基地',
							            columns: [
							                {
							                    xtype: 'gridcolumn',
							                    id: 'areaZBCN',
							                    dataIndex: 'area',
							                    text: '面积'
							                },
							                {
							                    xtype: 'gridcolumn',
							                    id: 'moneyZBCN',
							                    dataIndex: 'totalMoney',
							                    text: '金额'
							                }
							            ]
							        },
							        {
							            xtype: 'gridcolumn',
							            width: 299,
							            text: '补偿金第一次发放情况',
							            columns: [
							                {
							                    xtype: 'datecolumn',
							                    id: 'date1BCN',
							                    dataIndex: 'firstMoneyDate',
							                    text: '日期'
							                },
							                {
							                    xtype: 'gridcolumn',
							                    id: 'money1BCN',
							                    dataIndex: 'firstMoney',
							                    text: '补偿金额'
							                },
							                {
							                    xtype: 'actioncolumn',
							                    width: 70,
							                    layout: {
							                        type: 'fit'
							                    },
							                    suspendLayout: true,
							                    items: [
							                        {
							                        	handler: function(view, rowIndex, colIndex, item, e, record, row) {
				
							                        		jsID = record.get("id");
							                        		jsID = jsID + "," + "1";
							                            	window.location.href = "downHZD.action?path="+jsPath+"";
					                                    },
							                            disabled: false,
							                            icon: 'img/check.png',
							                            
							                        }
							                    ]
							                }
							            ]
							        },
							        {
							            xtype: 'gridcolumn',
							            width: 294,
							            text: '补偿金第二次发放情况',
							            columns: [
							                {
							                    xtype: 'datecolumn',
							                    id: 'date2BCN',
							                    dataIndex: 'secondMoneyDate',
							                    text: '日期'
							                },
							                {
							                    xtype: 'gridcolumn',
							                    id: 'money2BCN',
							                    dataIndex: 'secondMoney',
							                    text: '补偿金额'
							                },
							                {
							                    xtype: 'actioncolumn',
							                    width: 70,
							                    layout: {
							                        type: 'fit'
							                    },
							                    suspendLayout: true,
							                    items: [
							                        {
							                        	handler: function(view, rowIndex, colIndex, item, e, record, row) {
							                        		
							                        		jsID = record.get("id");
							                        		jsID = jsID + "," + "2";
							                            	window.location.href = "downHZD.action?path="+jsPath+"";
					                                    },
							                            altText: 'check',
							                            icon: 'img/check.png',
							                            iconCls: ''
							                        }
							                    ]
							                }
							            ]
							        }
							    ],
							    viewConfig: {
							        listeners: {
							            itemclick: {
							                fn: me.onViewItemClick,
							                scope: me
							            }
							        }
							    }
							}
                         ]
                },
                {
                	xtype: 'tabpanel',
                	 height: 476,
                     id: 'allMontAZ',
                     width: 764,
                     fixed: true,
                     activeTab: 0,
                     plain: true,
                     listeners: {
                         
                         tabchange: {
                             fn: me.onTabChangeAZ,
                             scope: me
                         }
                     },
                     items: 
                    	 [
							{
							    xtype: 'gridpanel',
							    id: 'montcAZ',
							    title: '安置监测',
							    store: 'montAZ',
							    columns: [
									{
									    xtype: 'gridcolumn',
									    id: 'projectIDAZ',
									    dataIndex: 'farmer.projectID',
									    text: '项目编号'
									},
							        {
							            xtype: 'gridcolumn',
							            id: 'nameFarmerAZ',
							            dataIndex: 'name',
							            text: '农户'
							        },
							        {
							            xtype: 'gridcolumn',
							            id: 'cardFarmerAZ',
							            dataIndex: 'idnumber',
							            text: '农户身份证'
							        },
							        {
							            xtype: 'gridcolumn',
							            id: 'numPkAz',
							            dataIndex: 'phone',
							            text: '电话'
							        },
							        {
							            xtype: 'gridcolumn',
							            id: 'addressAZ',
							            dataIndex: 'address',
							            text: '地址'
							        },
							        {
					                    xtype: 'actioncolumn',
					                    width: 70,
					                    layout: {
					                        type: 'fit'
					                    },
					                    suspendLayout: true,
					                    items: [
					                        {
					                        	handler: function(view, rowIndex, colIndex, item, e, record, row) {
					                        	
					                        		jsID = record.get("id");
					     
					                            	window.location.href = "downDirection.action?id="+jsID+"";
			                                    },
					                            altText: 'check',
					                            icon: 'img/check.png',
					                            iconCls: ''
					                        }
					                    ]
					                }
							    ],
//								 dockedItems: [
//						                        {
//						                            xtype: 'pagingtoolbar',
//						                            dock: 'top',
//						                            id: 'pagingAZ',
//						                            width: 360,
//						                            displayInfo: true,
//						                            displayMsg: ' ',
//						                            store: 'montAZ'	
//						                         }
//						                       ]
							},
							{
			                    xtype: 'gridpanel',
			                    id: 'montAZN',
			                    title: '安置监测(去向证明未上传)',
			                    store: 'montAZ',
			                    columns: [
									{
									    xtype: 'gridcolumn',
									    id: 'projectIDAZN',
									    dataIndex: 'farmer.projectID',
									    text: '项目编号'
									},
			                        {
			                            xtype: 'gridcolumn',
			                            id: 'nameFarmerAZN',
			                            dataIndex: 'name',
			                            text: '农户'
			                        },
			                        {
							            xtype: 'gridcolumn',
							            id: 'cardFarmerAZN',
							            dataIndex: 'idnumber',
							            text: '农户身份证'
							        },
			                        {
			                            xtype: 'gridcolumn',
			                            id: 'numPkAzN',
			                            dataIndex: 'phone',
			                            text: '电话'
			                        },
			                        {
			                            xtype: 'gridcolumn',
			                            id: 'addressAZ',
			                            dataIndex: 'address',
			                            text: '地址'
			                        },
			                        {
					                    xtype: 'actioncolumn',
					                    width: 70,
					                    layout: {
					                        type: 'fit'
					                    },
					                    suspendLayout: true,
					                    items: [
					                        {
					                        	handler: function(view, rowIndex, colIndex, item, e, record, row) {
					                        	
					                        		jsID = record.get("id");
					                            	window.location.href = "downDirection.action?id="+jsID+"";
			                                    },
					                            altText: 'check',
					                            icon: 'img/check.png',
					                            iconCls: ''
					                        }
					                    ]
					                }
			                    ]
			                }
                    	 ]
                },
                {
                    xtype: 'gridpanel',
                    id: 'montCQ',
                    title: '拆迁情况',
                    store: 'montCQ',
                    columns: [
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'numPK',
                            text: '片块号',
                        },
                        {
                            xtype: 'numbercolumn',
                            dataIndex: 'nameFarmer',
                            text: '农户',
                        },
                        {
                            xtype: 'gridcolumn',
                            text: '点击查看拆迁日志',
                            columns: [
                                {
                                    xtype: 'actioncolumn',
                                    height: 0,
                                    hideable: false,
                                    items: [
                                        {
                                            icon: 'img/check.png'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },
    
    //工具相关操作
    onZoomOut: function(button, e, eOpts) {
    	jsNavToolbar.activate(esri.toolbars.Navigation.ZOOM_OUT);
    	
    },
    
    onZoomIn: function(button, e, eOpts) {
    	
    	jsNavToolbar.activate(esri.toolbars.Navigation.ZOOM_IN);
    },
    onExtent: function(button, e, eOpts) {
    	
    	jsNavToolbar.zoomToFullExtent();
    },
    onCancel: function(button, e, eOpts) {
    	
    	jsNavToolbar.deactivate();
    },
    onShowCard: function(button, e, eOpts) {
	      var propertyPanel = Ext.create('Ext.grid.Panel', { 								    	  
	    	  region: 'center',
	    	  allowDeselect: true,
              columnLines: true,
              store: jswCardStore,
              columns: [	
					 {
						xtype: 'gridcolumn',
					    width: 75,
					    align: 'center',
					    dataIndex: 'projectID',
					    text: '项目编号'        										  
					 },
					 {
						 xtype: 'gridcolumn',
                        width: 75,
                        align: 'center',
                        dataIndex: 'QSDWMC',
                        text: '权属单位名称'        										  
					 },
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'DLMC',
                        text: '地类名称'        										  
					 },
					 {
						 xtype: 'gridcolumn',
                        width: 75,
                        align: 'center',
                        dataIndex: 'DYNHXM',
                        text: '户主姓名'        										  
					 },
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'DYNHSFZ',
                        text: '户主身份证号'        										  
					 },	
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'FWJG',
                        text: '房屋结构'        										  
					 },		
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'FWSYSJ',
                        text: '房屋使用时间'        										  
					 },	
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'SFDYXZSJ',
                        text: '对应现状地类'        										  
					 },
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'demolitionFlag',
                        text: '拆迁状态'        										  
					 },	
					 {
						 xtype: 'gridcolumn',
                        width: 150,
                        align: 'center',
                        dataIndex: 'shape_Area',
                        text: '地块面积'        										  
					 },
					 
			   ],
			   
	      });
	      var propertyWindow = Ext.create('Ext.window.Window',{
	    		title: '地块图层属性',
	    		width: 600,
	    		constrain: true,
	    		height: 600,
	    		layout: {
	    			type: 'border',
	    		},
	    		items: [
	    		     
	    		     {
						 xtype: 'panel',														 
						 region: 'south',
						 items: [
							  {
								  
								  xtype: 'button',
								  text: '确定',
								  handler: function(){
									  propertyWindow.destroy();
								  },
								  width: 70,
								  
							  },
						 ]
					 }
						 
	    		]
	    		 
	      });
	      propertyWindow.add(propertyPanel);
	      propertyWindow.show();
    },
    
    
    
    
    
    
    onTabChangeBC: function(tabPanel, newCard, oldCard, eOpts) {
    	  
    	var activeTitle = Ext.getCmp("allMontBC").getActiveTab().title;
    	
    	Ext.getCmp("montBC").getStore().load({params:{start:0,limit:2, category : "" + activeTitle + ""}});

    	//    	/(Ext.getCmp("allNotice").getActiveTab().getDockedItems('pagingtoolbar[dock="top"]'))[0].cursor = 0;
    },
    onTabChangeAZ: function(tabPanel, newCard, oldCard, eOpts) {
  	  
    	var activeTitle = Ext.getCmp("allMontAZ").getActiveTab().title;
 
    	Ext.getCmp("montcAZ").getStore().load({params:{start:0,limit:2, categoryAZ : "" + activeTitle + ""}});

    	//    	/(Ext.getCmp("allNotice").getActiveTab().getDockedItems('pagingtoolbar[dock="top"]'))[0].cursor = 0;
    },
    onViewItemClick: function(dataview, record, item, index, e, eOpts) {
        Ext.Msg.alert("查看详细信息");
    }

});