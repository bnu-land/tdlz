/*
 * File: app/view/acceptApply.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.acceptApply', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.acceptApply',

    requires: [
        'Ext.form.Panel',
        'Ext.form.field.TextArea',
        'Ext.button.Button',
        'Ext.form.field.ComboBox'
    ],

    layout: 'fit',
    title: '验收申请',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    height: 110,
                    id: 'applyForm',
                    autoScroll: true,
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    jsonSubmit: true,
                    method: '',
                    standardSubmit: false,
                    url: 'submit_apply',
                    items: [
                        {
                            xtype: 'textfield',
                            x: 40,
                            y: 100,
                            id: 'applyConUnit',
                            width: 320,
                            fieldLabel: '项目施工单位',
                            labelWidth: 85,
                            name: 'conUnit',
                            emptyText: '重庆大正土地规划整治有限公司'
                        },
                        {
                            xtype: 'textfield',
                            x: 550,
                            y: 280,
                            formBind: false,
                            frame: false,
                            hidden: true,
                            width: 240,
                            fieldLabel: '申请是否审核',
                            name: 'checkResult',
                            value: '未审核',
                            readOnly: true
                        },
                        {
                            xtype: 'textfield',
                            x: 410,
                            y: 100,
                            formBind: false,
                            frame: false,
                            id: 'fileCheck',
                            width: 320,
                            fieldLabel: '文件已上传',
                            labelWidth: 85,
                            name: 'fileCheck',
                            submitValue: false,
                            readOnly: true
                        },
                        {
                            xtype: 'textareafield',
                            x: 40,
                            y: 160,
                            height: 92,
                            id: 'applyNote',
                            width: 690,
                            fieldLabel: '备注说明',
                            labelWidth: 85,
                            name: 'note',
                            emptyText: '项目资料，已经通过自捡，现在提交项目验收评价申请'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                var fileCheck=Ext.getCmp('fileCheck').getValue();
                                var projectApplyId=Ext.getCmp('projectApplyId').getValue();
                                var projectApplyname=Ext.getCmp('projectApplyname').getValue();
                                var applyConUnit=Ext.getCmp('applyConUnit').getValue();
                                var applyNote=Ext.getCmp('applyNote').getValue();

                                if (fileCheck=='是') {
                                    Ext.Ajax.request({
                                        url:'submit_apply',
                                        method: 'POST',
                                        params:{PROJECTID:Ext.getCmp('projectApplyId').getValue(),
                                            projectnameG:Ext.getCmp('projectApplyname').getValue(),
                                            conUnit:Ext.getCmp('applyConUnit').getValue(),
                                            fileCheck:fileCheck,
                                            applyNote:Ext.getCmp('applyNote').getValue()
                                        },

                                        success:function(options, eOpts){
                                        Ext.Msg.alert('提示', '申请提交成功！'); },
                                        failure:function(options, eOpts){
                                        Ext.Msg.alert('提示', '申请提交失败！'); }

                                    });
                                } else {
                                    Ext.Msg.alert('提示', '请上传项目申请文件');
                                }

                            },
                            x: 220,
                            y: 300,
                            text: '提交申请'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                Ext.getCmp('applyForm').getForm().reset();
                            },
                            x: 480,
                            y: 300,
                            text: '重置'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                var tabs = this.up('tabpanel');
                                tabs.removeAll(true);
                                var newtab = tabs.add(Ext.widget('ManagAcceptApply'));
                            },
                            x: 350,
                            y: 300,
                            text: '查看申请'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                var win=new Ext.Window({
                                    height: 400,
                                    width: 1000,
                                    layout: {
                                        type: 'absolute'
                                    },
                                    title: '文件上传',

                                    modal: true,
                                    items: [
                                    {
                                        xtype: 'form',
                                        height: 400,
                                        width: 1000,
                                        id: 'applyForm1',
                                        autoScroll: true,
                                        layout: {
                                            type: 'absolute'
                                        },
                                        bodyPadding: 10,
                                        title: '',
                                        jsonSubmit: true,
                                        method: 'post',
                                        url: 'submit_applyFile',
                                        items: [
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var f=Ext.getCmp('applyForm1');
                                                var fkapplyfilename=Ext.getCmp('fkapplyfilename').getValue();
                                                var fkapplyReport=Ext.getCmp('fkapplyReport').getValue();
                                                var fkapplyFinancialDocuments=Ext.getCmp('fkapplyFinancialDocuments').getValue();
                                                var fkapplyBidding=Ext.getCmp('fkapplyBidding').getValue();
                                                var statusMap=Ext.getCmp('statusMap').getValue();
                                                var planMap=Ext.getCmp('planMap').getValue();
                                                var builtDrawingsMap=Ext.getCmp('builtDrawingsMap').getValue();
                                                var tabs = this.up('tabpanel');

                                                if(fkapplyfilename==''||fkapplyReport==''||fkapplyFinancialDocuments==''||fkapplyBidding==''||statusMap==''||planMap==''||builtDrawingsMap=='')
                                                {
                                                    Ext.MessageBox.alert('提示','请上传所有申请文件');
                                                }
                                                else
                                                {
                                                    Ext.MessageBox.confirm('提示','您确定要全部提交文件吗？',function(btn)
                                                    {
                                                        if(btn=='yes')
                                                        {
                                                            f.getForm().submit(
                                                            {
                                                                url:'submit_applyFile',
                                                                method:'post',
                                                                success:function(form, action){
                                                                    win.close();
                                                                    Ext.getCmp('fileCheck').setValue('是');
                                                                    Ext.MessageBox.alert('信息',action.result.msg);
                                                                },
                                                                failure:function(){

                                                                    Ext.MessageBox.alert('错误','操作失败！');
                                                                }
                                                            }
                                                            );

                                                        }
                                                    }
                                                    );
                                                }
                                            },
                                            x: 470,
                                            y: 320,
                                            text: '提交文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 50,
                                            y: 40,
                                            id: 'fkapplyfilename',
                                            fieldLabel: '复垦申请表(Word)',
                                            labelWidth: 145,
                                            name: 'fkapplyfilename',
                                            buttonText: '选择文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 50,
                                            y: 100,
                                            id: 'fkapplyReport',
                                            fieldLabel: '验收自检报告(Word)',
                                            labelWidth: 145,
                                            name: 'fkapplyReport',
                                            buttonText: '选择文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 50,
                                            y: 160,
                                            id: 'fkapplyFinancialDocuments',
                                            fieldLabel: '项目财务文件(Word)',
                                            labelWidth: 145,
                                            name: 'fkapplyFinancialDocuments',
                                            buttonText: '选择文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 50,
                                            y: 220,
                                            id: 'fkapplyBidding',
                                            fieldLabel: '招投标文件(Word)',
                                            labelWidth: 145,
                                            name: 'fkapplyBidding',
                                            buttonText: '选择文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 560,
                                            y: 40,
                                            id: 'statusMap',
                                            fieldLabel: '现状图(JPG)',
                                            labelWidth: 120,
                                            name: 'statusMap',
                                            buttonText: '选择文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 560,
                                            y: 100,
                                            id: 'planMap',
                                            fieldLabel: '规划图(JPG)',
                                            labelWidth: 120,
                                            name: 'planMap',
                                            buttonText: '选择文件'
                                        },
                                        {
                                            xtype: 'filefield',
                                            x: 560,
                                            y: 160,
                                            id: 'builtDrawingsMap',
                                            fieldLabel: '竣工图(JPG)',
                                            labelWidth: 120,
                                            name: 'builtDrawingsMap',
                                            buttonText: '选择文件'
                                        }
                                        ]
                                    }
                                    ]
                                });

                                win.show();

                            },
                            x: 740,
                            y: 100,
                            text: '上传项目申请文件'
                        },
                        {
                            xtype: 'combobox',
                            x: 40,
                            y: 40,
                            id: 'projectApplyId',
                            width: 320,
                            fieldLabel: '复垦项目编号',
                            labelWidth: 85,
                            name: 'projectId',
                            autoSelect: false,
                            displayField: 'projectId',
                            pageSize: 10,
                            store: 'ApplyprojectStore',
                            valueField: 'projectId',
                            listeners: {
                                select: {
                                    fn: me.onProjectApplyIdSelect,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'combobox',
                            x: 410,
                            y: 40,
                            id: 'projectApplyname',
                            width: 320,
                            fieldLabel: '复垦项目名称',
                            labelWidth: 85,
                            name: 'projectname',
                            displayField: 'projectname',
                            store: 'ApplyIdStore',
                            valueField: 'projectname'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onProjectApplyIdSelect: function(combo, records, eOpts) {
        var projectId=records[0].get('projectId');
        Ext.Ajax.request({
            url:'ApplyListId',
            params:{projectId:projectId},
            success:function(response){
                var mystore = Ext.StoreMgr.get('ApplyIdStore');
                mystore.load(
                {
                    params:{
                        projectId:projectId
                    }
                }
                );
            }
        });
        var ApplyIdStore=Ext.StoreMgr.get('ApplyIdStore');//获取store对象
        var countyField=Ext.getCmp("projectApplyname");
        countyField.setValue('');
        if(countyField.view)
        countyField.view.setStore(ApplyIdStore);
    }

});