/*
 * File: app/view/tpEfctEvlu.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.tpEfctEvlu', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.mytreepanel8',

    id: 'tpEfctEvlu',
    title: '效果评估',
    store: 'treestoreEfctEvlu',
    rootVisible: false,

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            viewConfig: {
                listeners: {
                    itemclick: {
                        fn: me.onViewItemClick,
                        scope: me
                    }
                }
            }
        });

        me.callParent(arguments);

    },

    onViewItemClick: function(dataview, record, item, index, e, eOpts) {
        Ext.getCmp("body").getLayout().setActiveItem(9);
        jsEvaluteProjectID = "";
        switch(record.raw.id)
        {
            case 1001:
            	
            	
            	var projectionStore = Ext.create('Ext.data.ArrayStore', {
            		proxy:{
                		type:"ajax",
                		url:"showProject.action",
                		
                		reader:{
                			type:"json",
                			root:"results",
                			totalProperty :'totalCount'		
                		},
                		actionMethods: {  
                            read: 'POST'  
                        },
                		writer:{
                			type:"json"
                		}
                	},
        		    fields: [  	
        		          {name: 'id', type: 'auto'},
        		          {name: 'projectNumber', type: 'string'},
        		          {name: 'projectAddress', type: 'string'},
        		          {name: 'createTime', type: 'date'},
        		          {name: 'projectStatus', type: 'string'},
        		          {name: 'endTime', type: 'date'},
        		          {name: 'projectDescription', type: 'string'},
        		    ],  
        		      
        		});  
            	projectionStore.load();
        	    var projectionPanel = Ext.create('Ext.grid.Panel', { 								    	  
        	    	emptyText: '没有项目可选择',
        	    	region: 'center',
        	    	allowDeselect: true,
                    columnLines: true,
                    store: projectionStore,
                    columns: [		         									 
                           {
                        	   xtype: 'gridcolumn',
                               width: 75,
                               align: 'center',
                               dataIndex: 'projectNumber',
                               text: '项目编号'        										  
                           },
        				   {
                        	   xtype: 'gridcolumn',
        	                   width: 150,
        	                   align: 'center',
        	                   dataIndex: 'projectAddress',
        	                   text: '项目所在地'        										  
        				   },
        				   {
        					   xtype: 'datecolumn',
        	                   width: 75,
        	                   align: 'center',
        	                   dataIndex: 'createTime',
        	                   text: '立项时间'        										  
        				   },
        				   {
        					   xtype: 'gridcolumn',
        	                   width: 150,
        	                   align: 'center',
        	                   dataIndex: 'projectDescription',
        	                    
        	                   text: '项目描述'        										  
        				   },
        							 
        			],
        				 
        			selModel: Ext.create('Ext.selection.CheckboxModel', {
        			    	
                    }) 
        	    });
        	    var projectionWindow = Ext.create('Ext.window.Window',{
            		title: '请选择项目',
            		width: 600,
            		
            		height: 400,
            		layout: {
            			type: 'border',
            		},
            		items: [
        				 {
        					 xtype: 'panel',	
        					 layout: 'hbox',
        					 region: 'south',
        					 items: [
        						  {
        							  
        							  xtype: 'button',
        							  text: '确定',
        							  handler: function(){
        								  if (projectionPanel.getSelectionModel().hasSelection()) {
        									  var records = projectionPanel.getSelectionModel().getSelection();
        									  jsEvaluteProjectID = records[0].get('projectNumber');
        						            	
        						              
        									  projectionWindow.destroy();		        								    		
										  }else{
											  Ext.Msg.alert('提示', "请选择一个项目");
										  }
								  
        							 },
        							 width: 70,

        						  },						  
								  {
									  xtype: 'button',
									  text: '取消',
									  handler: function(){
										  projectionWindow.destroy();
									  },
									  width: 70,
								  },
					         ]
        				 }					 
        			]	    		 
        	    });
        	    projectionWindow.add(projectionPanel);
			    projectionWindow.show();   

				Ext.getCmp("EfctEvlu").getLayout().setActiveItem(0);
	            var head = document.getElementsByTagName('head')[0]; 
	            var script= document.createElement("script"); 
	            script.type = "text/javascript"; 
	            script.src="MyMap/FinalMap.js"; 
	            head.appendChild(script);
	              
                break;            
        }
    }

});