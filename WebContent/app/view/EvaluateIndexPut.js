/*
 * File: app/view/EvaluateIndexPut.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.EvaluateIndexPut', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.EvaluateIndexPut',

    requires: [
        'Ext.form.Panel',
        'Ext.form.field.Text',
        'Ext.button.Button'
    ],

    layout: 'fit',
    title: '指标导入',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    height: 110,
                    id: 'EvaluateIndexPutForm',
                    autoScroll: true,
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    jsonSubmit: true,
                    standardSubmit: false,
                    url: '',
                    items: [
                        {
                            xtype: 'textfield',
                            x: 40,
                            y: 20,
                            id: 'projectId',
                            fieldLabel: '项目编号',
                            name: 'projectId',
                            readOnly: true
                        },
                        {
                            xtype: 'textfield',
                            x: 420,
                            y: 20,
                            id: 'proJectName',
                            width: 240,
                            fieldLabel: '项目名称',
                            name: 'projectName',
                            readOnly: true
                        },
                        {
                            xtype: 'textfield',
                            x: 40,
                            y: 170,
                            id: 'organicmatter',
                            fieldLabel: '有机质(g.kg-1)',
                            name: 'organicmatter'
                        },
                        {
                            xtype: 'textfield',
                            x: 40,
                            y: 220,
                            id: 'soiltexture',
                            fieldLabel: '土壤质地',
                            name: 'soiltexture'
                        },
                        {
                            xtype: 'textfield',
                            x: 420,
                            y: 220,
                            id: 'phvalue',
                            width: 240,
                            fieldLabel: 'pH值',
                            name: 'phvalue'
                        },
                        {
                            xtype: 'textfield',
                            x: 40,
                            y: 70,
                            id: 'soilThickness',
                            fieldLabel: '土层厚度(cm)',
                            name: 'soilThickness'
                        },
                        {
                            xtype: 'textfield',
                            x: 40,
                            y: 120,
                            id: 'soilmoisture',
                            fieldLabel: '土壤含水量(mm)',
                            name: 'soilmoisture'
                        },
                        {
                            xtype: 'textfield',
                            x: 420,
                            y: 70,
                            id: 'totalnitrogen',
                            width: 240,
                            fieldLabel: '全氮(mg.kg-1)',
                            name: 'totalnitrogen'
                        },
                        {
                            xtype: 'textfield',
                            x: 420,
                            y: 120,
                            id: 'totalphosphorus',
                            width: 240,
                            fieldLabel: '全磷(mg.kg-1)',
                            name: 'totalphosphorus'
                        },
                        {
                            xtype: 'textfield',
                            x: 420,
                            y: 170,
                            id: 'totalpotassium',
                            width: 240,
                            fieldLabel: '全钾(mg.kg-1)',
                            name: 'totalpotassium'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                var organicmatter=Ext.getCmp('organicmatter').getValue();
                                var soiltexture=Ext.getCmp('soiltexture').getValue();
                                var phvalue=Ext.getCmp('phvalue').getValue();
                                var soilThickness=Ext.getCmp('soilThickness').getValue();
                                var soilmoisture=Ext.getCmp('soilmoisture').getValue();
                                var totalnitrogen=Ext.getCmp('totalnitrogen').getValue();
                                var totalphosphorus=Ext.getCmp('totalphosphorus').getValue();
                                var totalpotassium=Ext.getCmp('totalpotassium').getValue();
                                var id=Ext.getCmp('projectId').getValue();
                                var name=Ext.getCmp('proJectName').getValue();

                                var tabs = this.up('tabpanel');
                                tabs.removeAll(true);
                                var newtab = tabs.add(Ext.widget('EvaluateResult'));

                                Ext.getCmp('proJecTid').setValue(id);
                                Ext.getCmp('proJecTname').setValue(name);

                                Ext.Ajax.request({
                                    url:'evaluate',
                                    method: 'GET',
                                    waitMsg:'正在进行评价中, 请稍等...',
                                    params:{organicmatter:organicmatter,
                                        soiltexture:soiltexture,
                                        phvalue:phvalue,
                                        soilThickness:soilThickness,
                                        soilmoisture:soilmoisture,
                                        totalnitrogen:totalnitrogen,
                                        totalphosphorus:totalphosphorus,
                                        totalpotassium:totalpotassium
                                    },

                                    success:function(response, options){
                                        //var respText = response.responseText;
                                        //respText=decodeURI(userName);
                                        var u =Ext.JSON.decode(response.responseText);
                                        Ext.Msg.alert('success',"评价已完成");
                                        Ext.getCmp('evaluateResult').setValue(u.evaluateResult);

                                    }

                                });

                                //这里是一个文本框
                                //items: [{
                                //    xtype: 'textfield',
                                //    id: 'txt',
                                //    name: 'yx'
                                //}]
                                //这里是一个ajax请求
                                //Ext.Ajax.request({
                                //    url: 'xxx',
                                //    method: 'GET',
                                //    success: function(response) {
                                //        var respText = Ext.decode(response.responseText);
                                //        //调用文本域的方法，设置它的值~
                                //        Ext.getCmp('txt').setValue(respText);
                                //    }
                                //});
                            },
                            x: 420,
                            y: 270,
                            icon: '',
                            text: '下一步'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {

                                var tabs = this.up('tabpanel');
                                tabs.removeAll(true);
                                //用tabs.add()新增加一个tab页面,通过Ext.widget(xtype)得到文章回收站的页面
                                var newtab = tabs.add(Ext.widget('EvaluateSelectProject'));
                            },
                            x: 210,
                            y: 270,
                            icon: '',
                            text: '上一步'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    }

});