/*
 * File: app/view/syrOneProjectAllData.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.syrOneProjectAllData', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.syrOneProjectAllData',

    requires: [
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.grid.View',
        'Ext.grid.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.selection.CheckboxModel',
        'Ext.button.Button',
        'Ext.form.field.Date',
        'Ext.toolbar.Paging'
    ],

    id: 'syrOneProjectAllData',
    layout: 'fit',
    title: '动态监测数据',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    autoShow: true,
                    height: 435,
                    id: 'Find_project',
                    layout: 'fit',
                    bodyPadding: 10,
                    title: '',
                    url: 'syrMonitorData',
                    items: [
                        {
                            xtype: 'gridpanel',
                            autoShow: true,
                            height: 870,
                            id: 'syrOneProject',
                            width: 667,
                            title: '',
                            forceFit: true,
                            store: 'syrMonitorData',
                            columns: [
                                {
                                    xtype: 'rownumberer'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    id: 'recordId',
                                    dataIndex: 'recordId',
                                    text: 'MyNumberColumn16'
                                },
                                {
                                    xtype: 'datecolumn',
                                    width: 69,
                                    align: 'center',
                                    dataIndex: 'monitorTime',
                                    text: '采集时间',
                                    format: 'Y-m-d'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 300,
                                    dataIndex: 'projectName',
                                    text: '项目名称'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'photoPath',
                                    text: '照片路径'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'dkId',
                                    text: '地块编号'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'monitorContent',
                                    text: '现场预警内容（利用类型）'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    align: 'center',
                                    dataIndex: 'tdpzPercent',
                                    text: '平整工程进度(%)',
                                    format: '00'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    align: 'center',
                                    dataIndex: 'ntslPercent',
                                    text: '水利工程进度(%)',
                                    format: '00'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    align: 'center',
                                    dataIndex: 'tjdlPercent',
                                    text: '道路工程进度(%)',
                                    format: '00'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'head',
                                    text: '采集人'
                                }
                            ],
                            selModel: Ext.create('Ext.selection.CheckboxModel', {

                            }),
                            dockedItems: [
                                {
                                    xtype: 'toolbar',
                                    dock: 'top',
                                    items: [
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var tabs = Ext.getCmp('myTabPanel');
                                                tabs.removeAll(true);
                                                var newtab = tabs.add(Ext.widget('syrDataManagement'));

                                                var mystore = Ext.StoreMgr.get('syrSchemeShow3'); //获得store对象
                                                mystore.load(
                                                {
                                                    params: {
                                                        start: '0',
                                                        limit: '15',
                                                        projectName: '',
                                                        province: '',
                                                        city: '',
                                                        county: '',
                                                        town: '',
                                                        contructstarttime: '',
                                                        contructendtime: ''
                                                    }
                                                });
                                            },
                                            height: 22,
                                            width: 94,
                                            icon: 'images/return.png',
                                            text: '返回项目列表'
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'projectname6',
                                            width: 241,
                                            fieldLabel: '项目名称',
                                            labelAlign: 'right',
                                            labelWidth: 60
                                        },
                                        {
                                            xtype: 'datefield',
                                            id: 'monitorstart6',
                                            width: 186,
                                            fieldLabel: '数据采集时间',
                                            labelAlign: 'right',
                                            labelWidth: 80
                                        },
                                        {
                                            xtype: 'datefield',
                                            id: 'monitorend6',
                                            width: 103,
                                            fieldLabel: '——',
                                            labelAlign: 'right',
                                            labelSeparator: '—',
                                            labelWidth: 20
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var  mystore=Ext.StoreMgr.get('syrMonitorData');//获取store对象

                                                /*在load时间中添加参数
                                                mystore.load(
                                                { params:{
                                                start:"0",
                                                limit:"15",
                                                projectName:Ext.getCmp('projectname6').getValue(),
                                                monitorstarttime:Ext.util.Format.date(Ext.getCmp('monitorstart6').getValue(),'Y-m-d'),
                                                monitorendtime:Ext.util.Format.date(Ext.getCmp('monitorend6').getValue(),'Y-m-d'),
                                                accuracy:"0"}
                                                }
                                                );
                                                */

                                                mystore.on('beforeload', function (store, options) {
                                                    var new_params = {projectName:Ext.getCmp('projectname6').getValue(),
                                                            monitorstarttime:Ext.util.Format.date(Ext.getCmp('monitorstart6').getValue(),'Y-m-d'),
                                                            monitorendtime:Ext.util.Format.date(Ext.getCmp('monitorend6').getValue(),'Y-m-d'),
                                                        accuracy:"0"};
                                                    Ext.apply(store.proxy.extraParams, new_params);
                                                });
                                                mystore.load({ params: { start: 0, limit: 15} });
                                            },
                                            width: 55,
                                            icon: 'images/file_view0.png',
                                            text: '搜索'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var projectStore = Ext.StoreMgr.get('syrSchemeShow2');

                                                var win=new Ext.Window({
                                                    height: 465,
                                                    width: 327,
                                                    title: '项目详情',
                                                    closable: true,
                                                    layout: 'fit',
                                                    jsonSubmit: true,
                                                    items: [
                                                    {
                                                        xtype: 'form',
                                                        id: 'MonitorDataAddForm',
                                                        layout: {
                                                            type: 'absolute'
                                                        },
                                                        anchorSize: 100,
                                                        bodyPadding: 10,
                                                        jsonSubmit: true,
                                                        items: [
                                                        {
                                                            xtype: 'datefield',
                                                            x: -4,
                                                            y: 20,
                                                            width: 290,
                                                            fieldLabel: '监测时间',
                                                            allowBlank: false,
                                                            name:'monitorTime',
                                                            labelAlign: 'right'
                                                        },{
                                                            xtype: 'combobox',
                                                            x: -5,
                                                            y: 60,
                                                            width: 290,
                                                            fieldLabel: '所属项目',
                                                            labelAlign: 'right',
                                                            allowBlank: false,
                                                            name:'projectName',
                                                            id: 'projectNAme',
                                                            displayField: 'projectName',
                                                            store: projectStore
                                                            //valueField: 'projectName'
                                                        },

                                                        {
                                                            xtype: 'textfield',
                                                            x: -5,
                                                            y: 100,
                                                            width: 290,
                                                            fieldLabel: '地块编号',
                                                            allowBlank: false,
                                                            labelAlign: 'right',
                                                            name:'dkId'
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            x: -6,
                                                            y: 140,
                                                            width: 290,
                                                            fieldLabel: '现场预警',
                                                            labelAlign: 'right',
                                                            name:'monitorContent'
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            x: -5,
                                                            y: 180,
                                                            width: 290,
                                                            fieldLabel: '采集人',
                                                            allowBlank: false,
                                                            name:'head',
                                                            labelAlign: 'right'
                                                        },


                                                        {
                                                            xtype: 'numberfield',
                                                            x: 40,
                                                            y: 220,
                                                            fieldLabel: '土地平整完成比例',
                                                            labelAlign: 'right',
                                                            maxValue: 1,
                                                            minValue: 0,
                                                            step:0.01,
                                                            allowBlank:false,
                                                            name:'tdpzPercent'
                                                        },
                                                        {
                                                            xtype: 'numberfield',
                                                            x: 40,
                                                            y: 260,
                                                            fieldLabel: '田间道路完成比例',
                                                            labelAlign: 'right',
                                                            maxValue: 1,
                                                            minValue: 0,
                                                            step:0.01,
                                                            allowBlank: false,
                                                            name:'tjdlPercent'
                                                        },
                                                        {
                                                            xtype: 'numberfield',
                                                            x: 40,
                                                            y: 300,
                                                            fieldLabel: '农田水利完成比例',
                                                            labelAlign: 'right',
                                                            maxValue: 1,
                                                            minValue: 0,
                                                            step:0.01,
                                                            allowBlank: false,
                                                            name:'ntslPercent'
                                                        },
                                                        {
                                                            xtype: 'filefield',
                                                            x: 30,
                                                            y: 350,
                                                            width: 260,
                                                            fieldLabel: '导入照片',
                                                            labelAlign: 'right',
                                                            labelWidth: 60,
                                                            allowBlank: false,
                                                            name:'photoPath'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, event) {
                                                                var myform = Ext.getCmp('MonitorDataAddForm').getForm();

                                                                if (myform.isValid()) { // make sure the form contains valid data before submitting
                                                                    myform.submit({
                                                                        url:'add_monitordata',
                                                                        success: function(form, action) {

                                                                            var mystore = Ext.StoreMgr.get('syrMonitorData'); //获得store对象
                                                                            //study LF
                                                                            mystore.load(
                                                                            {
                                                                                params: {
                                                                                    start: "0",
                                                                                    limit: "25",
                                                                                    projectName: Ext.getCmp('projectNAme').getValue(),
                                                                                    monitorstarttime: '',
                                                                                    monitorendtime: ''

                                                                                }
                                                                            }
                                                                            );
                                                                            Ext.Msg.alert('success', '添加数据成功'+mystore.storeId);
                                                                            win.close();

                                                                        },
                                                                        failure: function(form, action) {
                                                                            Ext.Msg.alert('failure', '添加失败');
                                                                            win.close();
                                                                        }
                                                                    });
                                                                } else {
                                                                    Ext.Msg.alert('注意', '填写信息不能为空，请检查！');
                                                                }

                                                                return;
                                                            },
                                                            x: 50,
                                                            y: 400,
                                                            text: '确定添加'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            x: 170,
                                                            y: 400,
                                                            text: '取消并返回',
                                                            handler:function(){
                                                                win.close();
                                                            }
                                                        }

                                                        ]
                                                    }]
                                                });

                                                win.show();
                                            },
                                            hidden: true,
                                            width: 70,
                                            icon: 'images/table_add.png',
                                            text: '手动添加'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var mystore = Ext.StoreMgr.get('syrMonitorData'); //获得store对象
                                                mystore.load(
                                                {
                                                    params: {
                                                        start: "0",
                                                        limit: "15",
                                                        projectName: '',
                                                        monitorstarttime: '',
                                                        monitorendtime: '',
                                                        accuracy:'0'//参数名称- 值
                                                    }
                                                });
                                            },
                                            text: '显示全部数据'
                                        }
                                    ]
                                }
                            ],
                            listeners: {
                                cellclick: {
                                    fn: me.onSyrOneProjectCellClick,
                                    scope: me
                                }
                            }
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'bottom',
                            width: 360,
                            displayInfo: true,
                            displayMsg: '显示 {0} - {1} 条，共 计{2}',
                            emptyMsg: '没有数据',
                            store: 'syrMonitorData'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onSyrOneProjectCellClick: function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {

        var win=new Ext.Window({
            height: 308,
            width: 425,
            title: '地块照片',
            closable: true,
            layout: 'fit',
            jsonSubmit: true,
            items: [
            {
                xtype: 'form',
                height: 400,
                layout: {
                    type: 'absolute'
                },
                bodyPadding: 10,
                title: '',
                jsonSubmit: true,
                items: [
                {
                    xtype: 'image',
                    x: 0,
                    y: 0,
                    height: 280,
                    width: 410,
                    src: record.data.photoPath
                }
                ]
            }
            ]
        });



        win.show();
    }

});