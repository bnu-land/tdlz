/*
 * File: app/view/reclProc.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.reclProc', {
    extend: 'Ext.container.Container',
    alias: 'widget.reclProc',

    id: 'ReclProc',
    layout: {
        type: 'card'
    },
   
    initComponent: function() {
        var me = this;

        
        
        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'gridpanel',
                    id: 'writeArea',
                    title: '农户拆迁面积录入',
                    allowDeselect: true,
                    store: 'reclProc',
                      
                    columns: [
						{
						    xtype: 'gridcolumn',
						    id: 'writeFamerPID',
						    dataIndex: 'farmer.projectID',
						    text: '项目编号'
						},
                        {
                            xtype: 'gridcolumn',
                            id: 'writeFamerName',
                            dataIndex: 'name',
                            text: '姓名'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'writeFamerIDCard',
                            width: 346,
                            dataIndex: 'card',
                            text: '身份证号码',
                         
                        },
                        {
                            xtype: 'numbercolumn',
                            id: 'writeFamerArea',
                            width: 186,
                            dataIndex: 'area',
                            text: '拆迁面积（平方米）',
                            editor: {
                                xtype: 'numberfield'
                            }
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'top',
                            width: 360,
                            displayInfo: true,
                            store: 'reclProc'
                        }
                    ],
                    plugins: [
                        Ext.create('Ext.grid.plugin.CellEditing', {
                            triggerEvent: 'celldblclick',
                        	clickToEdit : 1,
                            listeners : {
                                'edit' : function(editor,ctx){
                                	
                                	var jsArea = ctx.record.get("area");
                                	var jsID = ctx.record.get("id");
                              
                                	Ext.Ajax.request({
                                        //设置提交的地址  
                                        url:'changeArea.action',  
                                        //设置提交的方式为post  
                                        
                                        params : {
                            				area: "" + jsArea + "",
                            				id: "" + jsID + "",
                            			},
                                        method: 'post',  


                                        //网络成功返回  
                                        success: function(form, action) {  
                                        	

                                        	Ext.getCmp("writeArea").getStore().reload();

                                        },  
                                        //网络失败返回  
                                        failure: function(form, action) {  
                                            Ext.Msg.alert("修改失败");
                                        }  
                                    }); 
                                	
                                }
                            }
                        })
                    ],
                    selModel: Ext.create('Ext.selection.CheckboxModel', {

                    })
                },
                {
                    xtype: 'gridpanel',
                    id: 'verifyByFarmer',
                    title: '农户拆迁信息确认',
                    allowDeselect: true,
                    store: 'reclProc',
                    columns: [
                        {
                            xtype: 'gridcolumn',
                            id: 'name',
                            dataIndex: 'name',
                            text: '姓名'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'IDcard',
                            width: 231,
                            dataIndex: 'card',
                            text: '身份证号码',
      
                        },
                        {
                            xtype: 'numbercolumn',
                            id: 'Area',
                            width: 136,
                            dataIndex: 'area',
                            text: '拆迁面积（平方米）'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'money',
                            width: 161,
                            dataIndex: 'totalMoney',
                            text: '应得补偿金总额（元）'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'statusVerify',
                            dataIndex: 'statusComfire',
                            text: '确认状态'
                        },
                        {
                            xtype: 'gridcolumn',
                            text: '确认',
                            columns: [
                                {
                                    xtype: 'actioncolumn',
                                    height: 0,
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            
                                            	var jsID = record.get("id");
                                            
                                            	Ext.Msg.confirm('注意', '您同意进行拆迁?', isOK);
                                                function isOK(id){
                                                if (id == 'yes') {
                                            		                                     					  
                                					  Ext.Ajax.request({
                                						  url:'changeStatus.action',
                                						  params : {
                                              	
                                              				id: "" + jsID + "",
                                              				},
                                						   method:'post',   
                                						   
                                						   success:function(){										   
                                							   
                                							   Ext.Msg.alert("确认成功，你已经同意进行拆迁！");
                                							   
                                							   Ext.getCmp("writeArea").getStore().load({params:{flag: "1"}});
                                							 
                                						   	}
                                						   });
                                        				
                                                	}
                                                }
                                            },
                                            
	                                        icon: 'img/aud.png',
	                                        iconCls: ''
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'dateVerify',
                            dataIndex: 'comfireDate',
                            renderer:Ext.util.Format.dateRenderer('Y-m-d'),
                            text: '确认时间'
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'top',
                            width: 360,
                            displayInfo: true,
                            store: 'reclProc'
                        }
                    ],
                    selModel: Ext.create('Ext.selection.CheckboxModel', {

                    })
                },
                {
                    xtype: 'gridpanel',
                    id: 'inforFamer',
                    title: '补偿情况',
                    store: 'reclProc',
                    columns: [
                        {
                            xtype: 'gridcolumn',
                            id: 'numBcPk1',
                            width: 74,
                            dataIndex: 'card',
                            text: '身份证号'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'namefarmerBC1',
                            width: 62,
                            dataIndex: 'name',
                            text: '农户'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'areaZBC1',
                            dataIndex: 'area',
                            text: '面积'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'moneyZBC1',
                            dataIndex: 'totalMoney',
                            text: '金额'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 299,
                            text: '补偿金第一次发放情况',
                            columns: [
                                {
                                    xtype: 'datecolumn',
                                    id: 'date1BC1',
                                    dataIndex: 'firstMoneyDate',
                                    renderer:Ext.util.Format.dateRenderer('Y-m-d'),
                                    text: '日期'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    id: 'money1BC1',
                                    dataIndex: 'firstMoney',
                                    text: '补偿金额'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    id: 'status1BC1',
                                  
                                    text: '上传回执单',
                                    columns: [
                                        {
                                            xtype: 'actioncolumn',
                                            height: 0,
                                            width: 70,
                                            layout: {
                                                type: 'fit'
                                            },
                                            suspendLayout: true,
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                    	var jsID = record.get("id");    
                                                    	var jsCount = "1";
                                                		var fp = new Ext.FormPanel( {
                                                		       renderTo : Ext.getBody(),
                                                		       fileUpload : true,
                                                		       width : 523,
                                                		       frame : true,
                                                		       autoHeight : true,
                                                		       bodyStyle : 'padding: 10px 10px 0 10px;',
                                                		       labelWidth : 50,
                                                		       defaults : {
                                                		           anchor : '95%',
                                                		           allowBlank : false,
                                                		           msgTarget : 'side'
                                                		       },
                                                		         items : [
                                                		                            new Ext.form.FileUploadField( {
                                                		              buttonText: '浏览...',
                                                		              emptyText: '请选择一个文件',
                                                		              name : 'upload',
                                                		              width : 500,
                                                		              buttonCfg: {
                                                		                  width: 40,
                                                		                  iconCls: 'upload-icon'
                                                		              }
                                                		           }) 
                                                		    ],
                                                		        buttons : [ {
                                                		           text : '上传',
                                                		           handler : function() {
                                                		              if (fp.getForm().isValid()) {
                                                		                  fp.getForm().submit( {

                                                		                     method : 'post',
                                                		                     url :'uploadProc.action',// 后台处理的action
                                                		                     params:{
                                                		                    	 id :"" + jsID + "",
                                                		                    	 count : "" + jsCount + "",
                                                		                     },
                                                		                     waitMsg : '操作处理中，请稍等...',
                                                		                      waitTitle:'提示',
                                                		                     success :function(fp,action){
                                                		                         Ext.Msg.alert('Success', 'The value of success is: "'+action.result.success+'" on the server');
                                                		                         Ext.getCmp("writeArea").getStore().load({params:{flag: "1"}});
                                                		                         excelWindow.destroy();
                                                		                     },
                                                		                     failure : function(fp, action) {
                                                		                     
                                                		                            Ext.Msg.alert("上传成功");
                                                		                            Ext.getCmp("writeArea").getStore().load({params:{flag: "1"}});
                                                		                            excelWindow.destroy();
                                                		                     }
                                                		              });
                                                		                		
                                                		                            }
                                                		                   }
                                                		         }]
                                                		});
                                                		 
                                                		var excelWindow = new Ext.Window( {
                                                		       renderTo : Ext.getBody(),
                                                		       closeAction : "hide",
                                                		       plain : true,
                                                		       width : 540,
                                                		       title : "上传文件",
                                                		       modal : true,
                                                		       items:[fp]
                                                		    });
                                                		excelWindow.show();
                                                    },
                                                    icon: 'img/upload.png',
                                                    iconCls: ''
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 294,
                            text: '补偿金第二次发放情况',
                            columns: [
                                {
                                    xtype: 'datecolumn',
                                    id: 'date2BC1',
                                    dataIndex: 'secondMoneyDate',
                                    renderer:Ext.util.Format.dateRenderer('Y-m-d'),
                                    text: '日期'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    id: 'money2BC1',
                                    dataIndex: 'secondMoney',
                                    text: '补偿金额'
                                },
                                {
                                    xtype: 'booleancolumn',
                                    id: 'status2BC1',
                      
                                    text: '上传回执单',
                                    columns: [
                                        {
                                            xtype: 'actioncolumn',
                                            height: 0,
                                            width: 70,
                                            layout: {
                                                type: 'fit'
                                            },
                                            suspendLayout: true,
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
	                                                    var jsID = record.get("id");
                                                    	var jsCount = "2";
                                                    	var fp = new Ext.FormPanel( {
	                                             		       renderTo : Ext.getBody(),
	                                             		       fileUpload : true,
	                                             		       width : 523,
	                                             		       frame : true,
	                                             		       autoHeight : true,
	                                             		       bodyStyle : 'padding: 10px 10px 0 10px;',
	                                             		       labelWidth : 50,
	                                             		       defaults : {
	                                             		           anchor : '95%',
	                                             		           allowBlank : false,
	                                             		           msgTarget : 'side'
	                                             		       },
	                                             		         items : [
	                                             		                            new Ext.form.FileUploadField( {
	                                             		              buttonText: '浏览...',
	                                             		              emptyText: '请选择一个文件',
	                                             		              name : 'upload',
	                                             		              width : 500,
	                                             		              buttonCfg: {
	                                             		                  width: 40,
	                                             		                  iconCls: 'upload-icon'
	                                             		              }
	                                             		           }) 
	                                             		    ],
	                                             		        buttons : [ {
	                                             		           text : '上传',
	                                             		           handler : function() {
	                                             		              if (fp.getForm().isValid()) {
	                                             		                  fp.getForm().submit( {
	
	                                             		                     method : 'post',
	                                             		                     url :'uploadProc.action',// 后台处理的action
	                                             		                     params:{
	                                             		                    	 id :"" + jsID + "",
	                                             		                    	 count : "" + jsCount + "",
	                                             		                     },
	                                             		                     waitMsg : '操作处理中，请稍等...',
	                                             		                      waitTitle:'提示',
	                                             		                     success :function(fp,action){
	                                             		                         Ext.Msg.alert('Success', 'The value of success is: "'+action.result.success+'" on the server');
	                                             		                         Ext.getCmp("writeArea").getStore().load({params:{flag: "1"}});
	                                             		                         excelWindow.destroy();
	                                             		                     },
	                                             		                     failure : function(fp, action) {
	                                             		                     
	                                             		                            Ext.Msg.alert("上传成功");
	                                             		                            Ext.getCmp("writeArea").getStore().load({params:{flag: "1"}});
	                                             		                            excelWindow.destroy();
	                                             		                     }
	                                             		              });
	                                             		                		
	                                             		                            }
	                                             		                   }
	                                             		         }]
	                                             		});
                                             		 
	                                             		var excelWindow = new Ext.Window( {
	                                             		       renderTo : Ext.getBody(),
	                                             		       closeAction : "hide",
	                                             		       plain : true,
	                                             		       width : 540,
	                                             		       title : "上传文件",
	                                             		       modal : true,
	                                             		       items:[fp]
	                                             		    });
	                                             		excelWindow.show();
                                                    },
                                                    altText: 'check',
                                                    icon: 'img/upload.png',
                                                    iconCls: ''
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    viewConfig: {
                 
                    },
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'top',
                            width: 360,
                            displayInfo: true,
                            store: 'reclProc'
                        }
                    ]
                },
                {
                    xtype: 'gridpanel',
                    id: 'reclprocRecord',
                    title: '拆迁日志',
                    store: 'recordReclProc',
                    columns: [
                        {
                        	xtype: 'gridcolumn',
						    id: 'recordProjectID',
						    width: 127,
						    dataIndex: 'projectID',
						    text: '项目编号'
                        },
						{
						    xtype: 'gridcolumn',
						    id: 'recordPiece',
						    width: 127,
						    dataIndex: 'cp.houseNumber',
						    text: '房屋编号'
						},      
						{
						    xtype: 'gridcolumn',
						    id: 'recordHZ1',
						    width: 127,
						    dataIndex: 'cp.DYNHXM',
						    text: '拆迁户主姓名'
						},
                        {
                            xtype: 'gridcolumn',
                            id: 'recordSFZ1',
                            width: 127,
                            dataIndex: 'cp.DYNHSFZ',
                            text: '拆迁户主身份证'
                        },
                        {
                            xtype: 'datecolumn',
                            id: 'recordDate1',
                            width: 151,
                            dataIndex: 'date',
                            text: '创建时间'
                        },
                        {
                            xtype: 'gridcolumn',
                            text: '查看内容',
                            columns: [
                                {
                                    xtype: 'actioncolumn',
                                    height: 0,
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            	
                                            	Ext.getCmp("photoShow").removeAll();
                                            	var jsContent = record.get("content");
                                            	var jsCount = record.get("photoNumber");
                                            	var jsPath = record.get("photoPath");
                                            	var jsExt = record.get("photoExt");
                                            	var jsPerson = record.get("person");
                                            	var jsDate = record.get("date");
                                            	var jsCardStatus = record.get('cp.demolitionFlag');
                                            	var jsSFZ = record.get('cp.DYNHSFZ');
                                            	var jsName = record.get('cp.DYNHXM');
                                            	
                                            	Ext.getCmp("recordDate2").setValue(jsDate);
                                            	Ext.getCmp('recordSFZ2').setValue(jsSFZ);
                                            	Ext.getCmp('cardStatus2').setValue(jsCardStatus);
                                            	Ext.getCmp('recordHZ2').setValue(jsName);
                                            	Ext.getCmp("recordMem2").setValue(jsPerson);
                                            	Ext.getCmp("recordContent2").setValue(jsContent);
                                            	
                                            	//动态添加图片框
                                            	var ext= new Array();
                                            	ext =  jsExt.split(",");
                                            	for ( var i = 1; i <= jsCount; i++) {
                                            		var imgBox = new Ext.Img({
                 		                            	height: 201,
                 	                                    width: 201,
                 		                            });
                 		                            
                 		                            var path = "uploadPhoto/" + jsSFZ + jsDate + i.toString() + ext[i - 1];
                 	
                 		                            imgBox.setSrc(path);		                            
                 		                      
                 		                            Ext.getCmp("photoShow").add(imgBox);
												}
                                            	
                                            	
                                            	
                                            	
                                                Ext.getCmp("ReclProc").getLayout().setActiveItem(5);
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'top',
                            width: 360,
                            displayInfo: true,
                            items: [
                                {
                                    xtype: 'button',
                                    text: '新建日志',
                                    listeners: {
                                        click: {
                                            fn: me.onButtonClick,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'form',
                    height: 231,
                    id: 'newReclProcRecord',
                    bodyPadding: 10,
                    autoScroll: true,
                    title: '创建拆迁日志',
                    items: [
						{
						    xtype: 'textfield',					    
						    id: 'jsCount',
						    hidden: true,
						},
						{
                        	
                            xtype: 'combobox',
                            anchor: '100%',
                            fieldLabel: '拆迁状态',
                            id: 'cardStatus',
                            width: 1149,
                            mode: 'local',
                            emptyText: '请选择',
                            store: new Ext.data.ArrayStore({
                            	fields: ['value', 'text'],
                            	data:[
                            	    ['value1', '正在拆迁'],
                            	    ['value2', '拆迁完成'],
                            	]
                            }),
                            displayField: 'text',
                            valueField: 'value',
                            value: 'value1',
                            
                        },
                        {
                        	
                            xtype: 'datefield',
                            anchor: '100%',
                            id: 'recordDate',
                            width: 1149,
                            value:new Date(),
                            format : 'Y-m-d',
                            fieldLabel: '创建时间'
                        },
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordSFZ',
                            width: 1149,
                            fieldLabel: '拆迁户主身份证'
                        },
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordHZ',
                            fieldLabel: '拆迁户主姓名'
                        },
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordMem',
                            fieldLabel: '参与人员'
                        },
                        {
                            xtype: 'textareafield',
                            anchor: '100%',
                            height: 214,
                            id: 'recordContent',
                            fieldLabel: '日志内容'
                        },
                        {
                            xtype: 'fieldset',
                            id: 'photoSet',
                            height: 205,
                            autoScroll: true,
                            items: [
               
                            ]
                        },
                        {
                            xtype: 'button',
                            id: 'submitRecord',
                            text: '提交保存',
                            listeners: {
                                click: {
                                    fn: me.onSubmitRecordClick,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'button',
                            id: 'resetRecord',
                            text: '重置',
                            listeners: {
                                click: {
                                    fn: me.onResetRecordClick,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'button',
                            text: '返回',
                            listeners: {
                                click: {
                                    fn: me.onButtonClick1,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'button',
                            text: '上传图片',
                            
                            listeners: {
                                click: {
                                    fn: me.onButtonClick3,
                                    scope: me
                                }
                            }
                        
                        }
                    ]
                },
                {
                    xtype: 'form',
                    height: 231,
                    id: 'viewReclProcRecord',
                    autoScroll: true,
                    bodyPadding: 10,
                    title: '查看拆迁日志',
                    items: [
						{
						    xtype: 'textfield',
						    anchor: '100%',
						    id: 'cardStatus2',
						    fieldLabel: '拆迁状态'
						},
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordDate2',
                            fieldLabel: '创建时间'
                        },
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordSFZ2',
                            fieldLabel: '拆迁户主身份证'
                        },
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordHZ2',
                            fieldLabel: '拆迁户主姓名'
                        },
                        {
                            xtype: 'textfield',
                            anchor: '100%',
                            id: 'recordMem2',
                            fieldLabel: '参与人员'
                        },
                        {
                            xtype: 'textareafield',
                            anchor: '100%',
                            id: 'recordContent2',
                            fieldLabel: '日志内容'
                        },
                        {
                            xtype: 'fieldset',
                            id: 'photoShow',
                            height: 205,
                            autoScroll: true,
                            items: [
                                    
                            ]
                        },
                        {
                            xtype: 'button',
                            text: '返回',
                            listeners: {
                                click: {
                                    fn: me.onButtonClick11,
                                    scope: me
                                }
                            }
                        }
                    ]
                },
                {
                    xtype: 'gridpanel',
                   
                    id: 'reclprocProtocol',
                    title: '农户拆迁确认汇总表',
                    store: 'reclProc',
                    columns: [
						{
							xtype: 'gridcolumn',
						    id: 'recordProjectID',
						    width: 127,
						    dataIndex: 'farmer.projectID',
						    text: '项目编号'
						},
                        {
                            xtype: 'gridcolumn',
                            id: 'nameOutput',
                            dataIndex: 'name',
                            text: '姓名'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'IDcardOutput',
                            width: 187,
                            dataIndex: 'card',
                            text: '身份证号'
                        },
                        {
                            xtype: 'gridcolumn',
                            id: 'statusVerifyOutput',
                            width: 204,
                            dataIndex: 'statusComfire',
                            text: '是否已确认拆迁'
                        },
                        {
                            xtype: 'datecolumn',
                            id: 'dateVerifyOutput',
                            width: 224,
                            dataIndex: 'comfireDate',
                            renderer:Ext.util.Format.dateRenderer('Y-m-d'),
                            text: '日期'
                        },
                        {
                            xtype: 'gridcolumn',
                            text: '手印/印章'
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'top',
                            width: 360,
                            displayInfo: true,
                            items: [
                                {
                                    xtype: 'button',
                                    text: '导出成excel',
                                    listeners: {
                                        click: {
                                            fn: me.onButtonClick2,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        });


        me.callParent(arguments);
    },
    
    

    //新建日志
    onButtonClick: function(button, e, eOpts) {
      	
    	Ext.getCmp("jsCount").setValue(0);
    	Ext.getCmp("photoSet").removeAll();
        Ext.getCmp("ReclProc").getLayout().setActiveItem(4);
        
    },

    
    //提交日志
    onSubmitRecordClick: function(button, e, eOpts) {
    	
    	var jsContent = Ext.getCmp("recordContent").getValue();
    	var jsPerson = Ext.getCmp("recordMem").getValue();
    	var jsCount = Ext.getCmp("jsCount").getValue();
    	var jsSFZ = Ext.getCmp("recordSFZ").getValue();
    	var jsCardStatus = Ext.getCmp("cardStatus").getRawValue();
    	var jsDate = Ext.util.Format.date(Ext.getCmp("recordDate").getValue(), "Y-m-d");
    	alert(jsDate);
    	Ext.Ajax.request({
            //设置提交的地址  
            url:'addLog.action',  
            //设置提交的方式为post  
            
            params : {
            	count : "" + jsCount + "",
				content : "" + jsContent + "",
				person : "" + jsPerson + "",
				numberSFZ : "" + jsSFZ + "",
				cardStatus: "" + jsCardStatus +"",
				date : "" + jsDate + "",
			},
            method: 'post',  


            //网络成功返回  
            success: function(form, action) {  
            	Ext.Msg.show({
            	    title: '结果信息',
            	    msg: '创建日志成功',
            	    width: 300,
            	    buttons: Ext.Msg.OK,
            	    icon: Ext.window.MessageBox.INFO
            	});
            //	document.location='test1/app.jsp';
            //	Ext.Msg.alert("执行之后的");
            	Ext.getCmp("reclprocRecord").getStore().reload();
            
            	
            	
                Ext.getCmp("ReclProc").getLayout().setActiveItem(3);
                
            	//document.location='test1/app.jsp';
            },  
            //网络失败返回  
            failure: function(form, action) {  
               
            }  
        }); 
    	
    	Ext.getCmp("jsCount").setValue("0");
    	
    },

    onResetRecordClick: function(button, e, eOpts) {
    	
    },

    //新建日志返回
    onButtonClick1: function(button, e, eOpts) {
    	Ext.getCmp("jsCount").setValue("0");
        Ext.getCmp("ReclProc").getLayout().setActiveItem(3);
    },

   
    //上传图片
    onButtonClick3: function(button, e, eOpts) {
    	
    	var count = parseInt(Ext.getCmp("jsCount").getValue());
    	var jsSFZ = Ext.getCmp("recordSFZ").getValue();
    	count++;
    	Ext.getCmp("jsCount").setValue(count.toString());
    	
    	var jsDate = Ext.util.Format.date(Ext.getCmp("recordDate").getValue(), "Y-m-d");

		var jsDPhoto = new Ext.FormPanel( {
		       renderTo : Ext.getBody(),
		       fileUpload : true,
		       width : 523,
		       frame : true,
		       autoHeight : true,
		       bodyStyle : 'padding: 10px 10px 0 10px;',
		       labelWidth : 50,
		       defaults : {
		           anchor : '95%',
		           allowBlank : false,
		           msgTarget : 'side'
		       },
		         items : [
		                            new Ext.form.FileUploadField( {
		              buttonText: '浏览...',
		              emptyText: '请选择一个文件',
		              id : 'uploadPhoto',
		              name : 'upload',
		              width : 500,
		              buttonCfg: {
		                  width: 40,
		                  iconCls: 'upload-icon'
		              }
		           }) 
		    ],
		        buttons : [ {
		           text : '上传',
		           handler : function() {
		        	   
		              if (jsDPhoto.getForm().isValid() && 
		            		  Ext.getCmp("uploadPhoto").getRawValue() != 
		            			  "") {
		            	  
		           
		            	//记录后缀名	
		            	  var jsExt = Ext.getCmp("uploadPhoto").getRawValue();
		            	
		            	  jsExt = jsExt.substring(jsExt.lastIndexOf("."), jsExt.length);
		            	  	          
		            	  jsDPhoto.getForm().submit( {

		                     method : 'post',
		                     url :'uploadPhoto.action',// 后台处理的action
		                     params:{
		                    	 date :"" + jsDate + "",
		                    	 count :"" + count + "",
		         				 numberSFZ : "" + jsSFZ + "",
		        
		                     },
		                     waitMsg : '操作处理中，请稍等...',
		                      waitTitle:'提示',
		                     success :function(fp,action){
		                    	Ext.Msg.alert("上传成功");
		                    	 
	                            var imgBox = new Ext.Img({
	                            	height: 201,
                                    width: 201,
	                            });
	                            
	                            var jsPath = "uploadPhoto/" + jsSFZ + jsDate.toString() + count.toString() + jsExt;
	                            

	                            imgBox.setSrc(jsPath);		                            
	                      
	                            Ext.getCmp("photoSet").add(imgBox);
		                            
	                            dlog.destroy();
		                     },
		                     failure : function(fp, action) {
		                     
		                    	 var msg = "上传失败, 因为日期：（" +jsDate.toString() + 
		                    	 "）的日志已经创建, 请选择其他日期";
		                    	 	Ext.Msg.alert(msg);
		                        	var count = parseInt(Ext.getCmp("jsCount").getValue());
		                        	count--;
		                        	Ext.getCmp("jsCount").setValue(count.toString());                    
		                        	dlog.destroy();
		                     }
		              });
		                		
		                            }
		              else{
		            	  Ext.Msg.alert("你必须选择一个文件才能上传!");
		              }
		           
		                   }
		         }]
		});
		 
		var dlog = new Ext.Window( {
		       renderTo : Ext.getBody(),
		       closeAction : "hide",
		       plain : true,
		       width : 540,
		       title : "上传文件",
		       modal : true,
		       items:[jsDPhoto]
		    });
		dlog.show();
    	
    },

    onButtonClick11: function(button, e, eOpts) {
        Ext.getCmp("ReclProc").getLayout().setActiveItem(3);
    },

    //导出成excel
    onButtonClick2: function(button, e, eOpts) {
  
    	var jsProjectID;
    	Ext.Msg.confirm('提示', '是否要导出excel?', isOK);
        function isOK(id){
        if (id == 'yes') {
        	var projectionStore = Ext.create('Ext.data.ArrayStore', {
        		proxy:{
            		type:"ajax",
            		url:"showProject.action",
            		
            		reader:{
            			type:"json",
            			root:"results",
            			totalProperty :'totalCount'		
            		},
            		actionMethods: {  
                        read: 'POST'  
                    },
            		writer:{
            			type:"json"
            		}
            	},
    		    fields: [  	
    		          {name: 'id', type: 'auto'},
    		          {name: 'projectNumber', type: 'string'},
    		          {name: 'projectAddress', type: 'string'},
    		          {name: 'createTime', type: 'date'},
    		          {name: 'projectStatus', type: 'string'},
    		          {name: 'endTime', type: 'date'},
    		          {name: 'projectDescription', type: 'string'},
    		    ],  
    		      
    		});  
        	projectionStore.load();
    	    var projectionPanel = Ext.create('Ext.grid.Panel', { 								    	  
    	    	emptyText: '没有项目可选择',
    	    	region: 'center',
    	    	allowDeselect: true,
                columnLines: true,
                store: projectionStore,
                columns: [		         									 
                       {
                    	   xtype: 'gridcolumn',
                           width: 75,
                           align: 'center',
                           dataIndex: 'projectNumber',
                           text: '项目编号'        										  
                       },
    				   {
                    	   xtype: 'gridcolumn',
    	                   width: 150,
    	                   align: 'center',
    	                   dataIndex: 'projectAddress',
    	                   text: '项目所在地'        										  
    				   },
    				   {
    					   xtype: 'datecolumn',
    	                   width: 75,
    	                   align: 'center',
    	                   dataIndex: 'createTime',
    	                   text: '立项时间'        										  
    				   },
    				   {
    					   xtype: 'gridcolumn',
    	                   width: 150,
    	                   align: 'center',
    	                   dataIndex: 'projectDescription',
    	                    
    	                   text: '项目描述'        										  
    				   },
    							 
    			],
    				 
    			selModel: Ext.create('Ext.selection.CheckboxModel', {
    			    	
                }) 
    	    });
    	    var projectionWindow = Ext.create('Ext.window.Window',{
        		title: '请选择项目',
        		width: 600,
        		
        		height: 400,
        		layout: {
        			type: 'border',
        		},
        		items: [
    				 {
    					 xtype: 'panel',	
    					 layout: 'hbox',
    					 region: 'south',
    					 items: [
    						  {
    							  
    							  xtype: 'button',
    							  text: '确定',
    							  handler: function(){
    								  if (projectionPanel.getSelectionModel().hasSelection()) {
    									  var records = projectionPanel.getSelectionModel().getSelection();
    									  jsProjectID = records[0].get('projectNumber');
    									  Ext.MessageBox.wait("载入中...", "提示", {   
    							                 interval: 100       //进度条加载速度   
							              });   
								    	  Ext.Ajax.request({  
								             url: "gridToExcel.action",  
								             params: {
								            	 projectID: "" + jsProjectID + ""
								             },
								             success: function (reponse, option) {  
								                 
								                 Ext.MessageBox.hide();   
								                 window.location.href = "gridToExcel.action";
								                 Ext.Msg.alert("提示", "下载成功！");   
								             },  
								             failure: function () {  
								            	 Ext.MessageBox.hide(); 
								                 Ext.Msg.alert("提示", "下载失败！");   
								             }  
								          }); 
    									  projectionWindow.destroy();
    								  }
    							  }
    						  }
    				     ]
    				 }
    			]
    	     });
    	     projectionWindow.add(projectionPanel);
    	     projectionWindow.show();
    								  
        	 
	    	 
        	}
        }
    },

});

