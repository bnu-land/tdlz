/*
 * File: app/view/syrMonitorResult.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.syrMonitorResult', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.syrMonitorResult',

    requires: [
        'Ext.tab.Panel',
        'Ext.toolbar.Separator',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio',
        'Ext.form.Label',
        'Ext.tab.Tab',
        'Ext.grid.Panel',
        'Ext.grid.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.grid.View',
        'Ext.toolbar.Paging',
        'Ext.selection.CheckboxModel',
        'Ext.chart.Chart',
        'Ext.util.Point',
        'Ext.chart.axis.Category',
        'Ext.chart.axis.Numeric',
        'Ext.chart.series.Column',
        'Ext.grid.column.Boolean',
        'Ext.grid.column.Date',
        'Ext.form.field.Date',
        'Ext.Img',
        'Ext.toolbar.Fill'
    ],

    id: 'syrMonitorResult',
    layout: 'fit',
    title: '监测结果',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'tabpanel',
                    activeTab: 0,
                    items: [
                        {
                            xtype: 'panel',
                            height: 406,
                            layout: 'border',
                            title: '结果图',
                            items: [
                                {
                                    xtype: 'panel',
                                    region: 'center',
                                    split: true,
                                    html: '<div id = "mapdiv_syrMonitorResult" style = "width=100%;height:100%;">\r\n	<div id="bottomPanel_monitor">\r\n        <div id="timeInfo_monitor">\r\n          <div>复垦项目监测时间节点，当前正在查看<b><span id="taishi_daterange">2012-02</span></b>的数据</div>\r\n          <div id="timeSliderDiv_monitor"></div>\r\n        </div>\r\n    </div>\r\n	<div id="info_monitor">\r\n		<div id = "monitor_prjId" style = "border-bottom: 1px solid #444;">		\r\n			<h3>项目名称</h3>\r\n			<span id="projectNameDiv" >长寿区复垦项目</span>\r\n		</div>\r\n		<div id = "monitorInfo" style="padding:5px;font-family: arial;font-size: 15px;" >\r\n			<div style = "border-bottom: 1px solid #444;"><b>是否进度异常：</b><span id="isJinduAbnormalDiv">否</span></div>\r\n			<div>\r\n				<b><span>复垦工程进度</span></b>\r\n				<span id="fukenjinduInfoDiv"></span>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>',
                                    title: '地图',
                                    dockedItems: [
                                        {
                                            xtype: 'toolbar',
                                            dock: 'top',
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, event) {
                                                        var tabs = Ext.getCmp('myTabPanel');
                                                        tabs.removeAll(true);
                                                        var newtab = tabs.add(Ext.widget('syrDataManagement'));
                                                    },
                                                    height: 22,
                                                    width: 100,
                                                    icon: 'images/return.png',
                                                    text: '返回项目列表'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'radiogroup',
                                                    id: 'radioGroup_monitor',
                                                    width: 270,
                                                    fieldLabel: '查看地图',
                                                    labelWidth: 60,
                                                    items: [
                                                        {
                                                            xtype: 'radiofield',
                                                            name: 'monitor',
                                                            boxLabel: '规划图',
                                                            inputValue: '规划图'
                                                        },
                                                        {
                                                            xtype: 'radiofield',
                                                            name: 'monitor',
                                                            boxLabel: '现状图',
                                                            inputValue: '现状图'
                                                        },
                                                        {
                                                            xtype: 'radiofield',
                                                            name: 'monitor',
                                                            boxLabel: '竣工图',
                                                            inputValue: '竣工图'
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    id: 'checkBox_monitor_RSImage',
                                                    boxLabel: '对比遥感底图',
                                                    inputValue: 'true',
                                                    uncheckedValue: 'false'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    id: 'checkBox_monitor_jindu',
                                                    boxLabel: '查看工程进度',
                                                    checked: true,
                                                    inputValue: 'true',
                                                    uncheckedValue: 'false'
                                                },
                                                {
                                                    xtype: 'button',
                                                    id: 'btn_monitor_scopeAbnormal',
                                                    text: '地块范围异常'
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    id: 'prjid_result',
                                                    width: 100,
                                                    text: '项目编号'
                                                }
                                            ]
                                        }
                                    ],
                                    listeners: {
                                        afterrender: {
                                            fn: me.onPanelAfterRender,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'tabpanel',
                                    region: 'east',
                                    split: true,
                                    width: 200,
                                    activeTab: 0,
                                    items: [
                                        {
                                            xtype: 'panel',
                                            layout: 'fit',
                                            title: '地块列表',
                                            items: [
                                                {
                                                    xtype: 'gridpanel',
                                                    id: 'monitorResult_graphicsGrid',
                                                    autoScroll: true,
                                                    columns: [
                                                        {
                                                            xtype: 'rownumberer'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            width: 120,
                                                            dataIndex: 'landparcelid',
                                                            text: '地块编号'
                                                        },
                                                        {
                                                            xtype: 'numbercolumn',
                                                            dataIndex: 'area',
                                                            text: '地块面积(平方米)'
                                                        }
                                                    ],
                                                    listeners: {
                                                        cellclick: {
                                                            fn: me.onMonitorResult_graphicsGridCellClick,
                                                            scope: me
                                                        }
                                                    }
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            width: 100,
                                            layout: 'border',
                                            title: '异常地块列表',
                                            items: [
                                                {
                                                    xtype: 'gridpanel',
                                                    region: 'center',
                                                    frame: true,
                                                    id: 'projectDikuaiGrid2',
                                                    autoScroll: true,
                                                    headerPosition: 'right',
                                                    title: '',
                                                    subGridXType: '',
                                                    columnLines: true,
                                                    forceFit: true,
                                                    columns: [
                                                        {
                                                            xtype: 'rownumberer',
                                                            width: 36,
                                                            text: '序号'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            width: 52,
                                                            dataIndex: 'recordId',
                                                            text: '记录号'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'landId',
                                                            text: '地块编号'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'projectId',
                                                            text: '项目编号'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'projectname',
                                                            text: '项目名称'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'fukenArea',
                                                            text: '片块面积'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'fukenqianLandUse',
                                                            text: '复垦前土地利用类型'
                                                        }
                                                    ],
                                                    dockedItems: [
                                                        {
                                                            xtype: 'pagingtoolbar',
                                                            dock: 'bottom',
                                                            width: 360,
                                                            autoScroll: true,
                                                            displayInfo: true,
                                                            displayMsg: '显示 {0} - {1} 条，共 计{2}',
                                                            emptyMsg: '没有数据',
                                                            store: 'FKJCResultDikuaiStore'
                                                        }
                                                    ],
                                                    selModel: Ext.create('Ext.selection.CheckboxModel', {

                                                    })
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'panel',
                            autoRender: true,
                            autoShow: true,
                            id: 'progresstable',
                            layout: 'border',
                            title: '工程进度表',
                            items: [
                                {
                                    xtype: 'chart',
                                    region: 'center',
                                    store: 'yqprjmonitorInfoStore',
                                    axes: [
                                        {
                                            type: 'Category',
                                            fields: [
                                                'monitorTime'
                                            ],
                                            title: '监测时间',
                                            position: 'bottom'
                                        },
                                        {
                                            type: 'Numeric',
                                            label: {
                                                renderer: Ext.util.Format.numberRenderer('0%')
                                            },
                                            dashSize: 2,
                                            title: '工程进度',
                                            decimals: 1,
                                            maximum: 100,
                                            minimum: 0,
                                            position: 'left'
                                        }
                                    ],
                                    series: [
                                        {
                                            type: 'column',
                                            renderer: function(sprite, record, attributes, index, store) {
                                                var colors = ['rgb(250, 128, 114)', 'rgb(255, 0, 0)', 'rgb(0, 255, 127)',  'rgb(34, 139, 34)',  'rgb(218, 112,224)', 'rgb(160, 32, 240)'];

                                                attributes.fill = colors[index % colors.length];

                                                return attributes;
                                            },
                                            title: [
                                                '土地平整预期进度',
                                                '土地平整实际进度',
                                                '田间道路预期进度',
                                                '田间道路实际进度',
                                                '农田水利预期进度',
                                                '农田水利实际进度'
                                            ],
                                            axis: 'left',
                                            yField: [
                                                'ypercentPz',
                                                'ppercentPz',
                                                'ypercentDl',
                                                'ppercentDl',
                                                'ypercentSl',
                                                'ppercentSl'
                                            ],
                                            stacked: false,
                                            xPadding: 0
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    region: 'south',
                                    height: 200,
                                    id: 'taskgrid1',
                                    fixed: true,
                                    autoScroll: true,
                                    title: '',
                                    forceFit: true,
                                    store: 'yqprjmonitorInfoStore',
                                    viewConfig: {
                                        height: 100
                                    },
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            width: 400,
                                            dataIndex: 'monitorTime',
                                            text: '项目名称'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            align: 'center',
                                            dataIndex: 'monitorTime',
                                            text: '监测时间'
                                        },
                                        {
                                            xtype: 'numbercolumn',
                                            hidden: true,
                                            dataIndex: 'recordId',
                                            text: 'record_id'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            text: '土地平整工程',
                                            columns: [
                                                {
                                                    xtype: 'numbercolumn',
                                                    width: 120,
                                                    align: 'center',
                                                    dataIndex: 'ypercentPz',
                                                    text: '预期进度(%)',
                                                    format: '00'
                                                },
                                                {
                                                    xtype: 'numbercolumn',
                                                    width: 120,
                                                    align: 'center',
                                                    dataIndex: 'ppercentPz',
                                                    text: '实际进度(%)',
                                                    format: '00'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            text: '田间道路工程',
                                            columns: [
                                                {
                                                    xtype: 'numbercolumn',
                                                    width: 120,
                                                    align: 'center',
                                                    dataIndex: 'ypercentDl',
                                                    text: '预期进度(%)',
                                                    format: '00'
                                                },
                                                {
                                                    xtype: 'numbercolumn',
                                                    width: 120,
                                                    align: 'center',
                                                    dataIndex: 'ppercentDl',
                                                    text: '实际进度(%)',
                                                    format: '00'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            text: '农田水利工程',
                                            columns: [
                                                {
                                                    xtype: 'numbercolumn',
                                                    width: 120,
                                                    align: 'center',
                                                    dataIndex: 'ypercentSl',
                                                    text: '预期进度(%)',
                                                    format: '00'
                                                },
                                                {
                                                    xtype: 'numbercolumn',
                                                    width: 120,
                                                    align: 'center',
                                                    dataIndex: 'ppercentSl',
                                                    text: '实际进度(%)',
                                                    format: '00'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'booleancolumn',
                                            hidden: true,
                                            width: 81,
                                            dataIndex: 'isSended',
                                            text: '是否已下达'
                                        },
                                        {
                                            xtype: 'booleancolumn',
                                            hidden: true,
                                            width: 68,
                                            dataIndex: 'isFinished',
                                            text: '是否已完成'
                                        },
                                        {
                                            xtype: 'datecolumn',
                                            hidden: true,
                                            dataIndex: 'finishTime',
                                            text: '完成时间'
                                        }
                                    ],
                                    selModel: Ext.create('Ext.selection.CheckboxModel', {

                                    }),
                                    dockedItems: [
                                        {
                                            xtype: 'pagingtoolbar',
                                            dock: 'bottom',
                                            width: 360,
                                            displayInfo: true,
                                            displayMsg: '显示 {0} - {1} 条，共 计{2}',
                                            emptyMsg: '没有数据',
                                            store: 'yqprjmonitorInfoStore'
                                        },
                                        {
                                            xtype: 'toolbar',
                                            dock: 'top',
                                            hidden: true,
                                            width: 950,
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    id: 'projectnamess1',
                                                    width: 281,
                                                    fieldLabel: '项目名称',
                                                    labelWidth: 50
                                                },
                                                {
                                                    xtype: 'datefield',
                                                    id: 'monitorstart9',
                                                    width: 186,
                                                    fieldLabel: '预期监测时间',
                                                    labelAlign: 'right',
                                                    labelWidth: 80
                                                },
                                                {
                                                    xtype: 'datefield',
                                                    id: 'monitorend9',
                                                    width: 103,
                                                    fieldLabel: '——',
                                                    labelAlign: 'right',
                                                    labelSeparator: '—',
                                                    labelWidth: 20
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    hidden: true,
                                                    id: 'projectname10',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, event) {
                                                        var  mystore=Ext.StoreMgr.get('yqprjmonitorInfoStore');//获取store对象

                                                        //在load时间中添加参数
                                                        mystore.load(
                                                        { params:{
                                                            start:"0",
                                                            limit:"15",
                                                            projectName:Ext.getCmp('projectnamess').getValue(),
                                                            monitorstarttime:Ext.util.Format.date(Ext.getCmp('monitorstart8').getValue(),'Y-m-d'),
                                                            monitorendtime:Ext.util.Format.date(Ext.getCmp('monitorend8').getValue(),'Y-m-d'),
                                                        accuracy:"0"}
                                                    }
                                                    );

                                                    },
                                                    width: 55,
                                                    icon: 'images/file_view0.png',
                                                    text: '搜索'
                                                },
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, event) {
                                                        Ext.getCmp('projectnamess').setValue('');

                                                        var mystore = Ext.StoreMgr.get('yqprjmonitorInfoStore'); //获得store对象
                                                        mystore.load(
                                                        {
                                                            params: {
                                                                start: "0",
                                                                limit: "15",
                                                                projectName: '',
                                                                monitorstarttime:'',
                                                                monitorendtime:'',
                                                                accuracy:'0'
                                                            }
                                                        });
                                                    },
                                                    text: '显示全部'
                                                },
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, event) {
                                                        var grid = Ext.getCmp('taskgrid');
                                                        var record =grid.getSelectionModel().getSelection();//获取到表上的那一列
                                                        if(record.length===0){
                                                            Ext.Msg.alert('提示','请先选择您要操作的行！');
                                                            return;
                                                        }
                                                        else {
                                                            var  recordIds =new Array(record.length);
                                                            for(var i = 0;i<record.length;i++){
                                                                recordIds[i] = record[i].get("recordId");

                                                            }
                                                            //Ext.Msg.alert('提示',articleIds);



                                                            Ext.Ajax.request({
                                                                url:'del_yqmonitorInfodataByIds',
                                                                params:{recordIds:recordIds},
                                                                success:function(response){
                                                                    var mystore = Ext.StoreMgr.get('yqprjmonitorInfoStore'); //获得store对象
                                                                    mystore.load(
                                                                    {
                                                                        params: {
                                                                            start: "0",
                                                                            limit: "15",
                                                                            projectName: ''
                                                                        }
                                                                    });


                                                                    Ext.Msg.alert('success','删除数据成功!');


                                                                }

                                                            });

                                                        }
                                                    },
                                                    text: '删除'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    region: 'east',
                                    width: 126,
                                    title: '',
                                    items: [
                                        {
                                            xtype: 'image',
                                            src: 'images/legend.png'
                                        }
                                    ]
                                }
                            ],
                            dockedItems: [
                                {
                                    xtype: 'toolbar',
                                    dock: 'top',
                                    items: [
                                        {
                                            xtype: 'tbfill',
                                            flex: 1
                                        },
                                        {
                                            xtype: 'label',
                                            flex: 3,
                                            id: 'prjnameresult',
                                            text: 'My Label'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onPanelAfterRender: function(component, eOpts) {
        //加入地图的js文件
        var head = document.getElementsByTagName('head')[0];
        var script= document.createElement("script");
        script.type = "text/javascript";
        script.src="map/syrMonitorResult_map.js";
        head.appendChild(script);
    },

    onMonitorResult_graphicsGridCellClick: function(tableview, td, cellIndex, record, tr, rowIndex, e, eOpts) {
        var graphic = record.get('graphic');
        locateByGraphic(graphic);
    }

});