/*
 * File: app/view/tpUser.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.tpUser', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.mytreepanel11',

    id: 'tpUser',
    collapseFirst: false,
    collapsed: false,
    collapsible: true,
    title: '用户',
    store: 'treestoreUser',
    rootVisible: false,

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            viewConfig: {
                listeners: {
                    itemclick: {
                        fn: me.onViewItemClick,
                        scope: me
                    }
                }
            }
        });

        me.callParent(arguments);
    },

     onViewItemClick: function(dataview, record, item, index, e, eOpts) {
    	Ext.getCmp("body").getLayout().setActiveItem(1);
        switch(record.raw.id)
        {
            case 201: 
            	{
            	var userStore = Ext.create('Ext.data.Store', {            		   
            	    proxy: {
            	        // load using HTTP
            	        type: 'ajax',
            	        url: 'showUserInformationByID.action',  
            	        // the return will be XML, so lets set up a reader
            	        reader:{
                			type:"json",
                			root:"results",
                			totalProperty :'totalCount'		
                		},
                		actionMethods: {  
                            read: 'POST'  
                        },
                		writer:{
                			type:"json"
                		}
            	    },            	  
                    fields: [
                            {name: 'id', type:'auto'},
            		        {name: 'username',  type: 'string', useNull: true},              		       
                 	        {name: 'phone',  type: 'string'},                 	        
                 	        {name: 'permission', type: 'string'},
                 	        {name: 'password', type: 'string'},  
                 	        //农户
                 	        {name: 'farmername', type: 'string'},
                 	        {name: 'address', type: 'string'},
                	        {name: 'sex', type: 'string'},
                	        {name: 'idnumber',  type: 'long'},
                	        //业主单位
                	        {name: 'email', type: 'string'},
                 	        {name: 'level', type: 'string'},
                	        {name: 'department', type: 'string'},
                	        //行政管理单位
                	        {name: 'email', type: 'string'},
                 	        {name: 'level', type: 'string'},
                	        {name: 'department', type: 'string'},
                 	        ]            	    
            	});   
            	userStore.load({
            		callback: function(records, options, success){	            		    
                		//遍历store
                		userStore.each(function(record) {	
                			var jsPermission = record.get("permission");                		
    	            	    if(jsPermission == "农户") {
    	            	    	Ext.getCmp("tfUsernameFarmerMod").setValue(record.get("username"));	  
	    	            	    Ext.getCmp("tfFarmernameFarmerMod").setValue(record.get("farmername"));
	    	            	    Ext.getCmp("tfUserIdFarmerMod").setValue(record.get("idnumber"));
	    	                	Ext.getCmp("tfMobilephoneFarmerMod").setValue(record.get("phone"));
	    	                	Ext.getCmp("tfAdressFarmerMod").setValue(record.get("address"));
	    	                	//性别
	    	                	if(record.get("sex")=="男") {	    	                		
	    	                		Ext.getCmp("rMaleFarmerMod").setValue(true);
	    	                	}
	    	                	if(record.get("sex")=="女") {
	    	                		Ext.getCmp("rFemaleFarmerMod").setValue(true);
	    	                	}
	    	                	Ext.getCmp("tfPasswordFarmerMod").setValue(record.get("password"));
	    	                	Ext.getCmp("tfRePasswordFarmerMod").setValue(record.get("password"));
	    	                	var jsUserID = record.get("id");
	    	                	Ext.getCmp("farmerID").setValue(jsUserID);                      	    
	    	                	Ext.getCmp("ctnUser").getLayout().setActiveItem(0);
    	            	    }   
    	            	    else if(jsPermission == "业主单位") {
    	            	    	Ext.getCmp("tfUsernameOwnerMod").setValue(record.get("username"));	  
	    	            	    Ext.getCmp("tfMobilephoneOwnerMod").setValue(record.get("phone"));
	    	            	    Ext.getCmp("tfEmailOwnerMod").setValue(record.get("email"));
	    	                	Ext.getCmp("tfLevelOwnerMod").setValue(record.get("level"));
	    	                	Ext.getCmp("tfDepartmentOwnerMod").setValue(record.get("department"));	    	                	
	    	                	Ext.getCmp("tfPasswordOwnerMod").setValue(record.get("password"));
	    	                	Ext.getCmp("tfRePasswordOwnerMod").setValue(record.get("password"));
	    	                	var jsUserID = record.get("id");
	    	                	Ext.getCmp("ownerID").setValue(jsUserID);                      	    
	    	                	Ext.getCmp("ctnUser").getLayout().setActiveItem(1);
    	            	    }
    	            	    else if(jsPermission == "行政管理单位") {
    	            	    	Ext.getCmp("tfUsernameAdminMod").setValue(record.get("username"));	  
	    	            	    Ext.getCmp("tfMobilephoneAdminMod").setValue(record.get("phone"));
	    	            	    Ext.getCmp("tfEmailAdminMod").setValue(record.get("email"));
	    	                	Ext.getCmp("tfLevelAdminMod").setValue(record.get("level"));
	    	                	Ext.getCmp("tfDepartmentAdminMod").setValue(record.get("department"));	    	                	
	    	                	Ext.getCmp("tfPasswordAdminMod").setValue(record.get("password"));
	    	                	Ext.getCmp("tfRePasswordAdminMod").setValue(record.get("password"));
	    	                	var jsUserID = record.get("id");
	    	                	Ext.getCmp("adminID").setValue(jsUserID);                      	    
	    	                	Ext.getCmp("ctnUser").getLayout().setActiveItem(2);
    	            	    }
    	            	    });       			                     		
                		}
            	});           	            		
        		break;           	
        		}   
            case 202:Ext.getCmp("ctnUser").getLayout().setActiveItem(3);
            Ext.getCmp("gpUserControl").getStore().reload();
            break;//查看用户
            case 203:Ext.getCmp("ctnUser").getLayout().setActiveItem(3);//添加用户
            var winPermission = new Ext.Window(
            {
                //指定窗口的标题
                title: "请选择要添加的用户类型",
                //窗口的宽度
                width:245,
                //窗口的高度
                height: 115,
                layout:
                {
                    type: 'absolute'
                },
                //是否为模式窗口，模式窗口是指到这个窗口弹出后将不能点击后面的窗口
                modal: true,
                //窗口显示的内容，内容为一个form表单控件                 
                items: 
                [{
                    xtype: 'combobox',
                    id:'cmbPermission',
                    x: 40,
                    y: 15,
                    width: 150,
                    emptyText:'请选择用户权限',
                    hideLabel:true,             
                    editable: false,            
                    displayField: 'permission',            
                    forceSelection: true,            
                    queryMode: 'local',                            
                    store: 'storePermission',            
                    valueField: 'id'            
                }],     
                //为这个窗口配置按钮，一个确定按钮，一个取消按钮    
                buttons:         
                [
                {
                    //引用类型为button
                    xtype: "button",            
                    text: "下一步",
                    //响应事件
                    handler: function () 
                    {         
                        //农户
                        if(Ext.getCmp("cmbPermission").getValue()==1)
                        {
                            var winAddFarmer = new Ext.Window(
                            {                            
                                title: "添加农户用户",                            
                                width:350,
                                height: 300,                                 
                                modal: true,                               
                                items: [{                                
                                    xtype: "form",                                
                                    id: "frmFarmer",
                                    height: "300",
                                    borderStyle: "padding-top:3px",
                                    frame: true,
                                    defaultType: "textfield",
                                    labelAlign: "right",
                                    labelWidth: 60,
                                    defaults: {
                                        allowBlank: false, width: 300
                                    },
                                    items: 
                                    [
                                    { fieldLabel: "项目编号", id: "ProjectID", blankText: "请输入所在项目编号" },
                                    { fieldLabel: "用户名", id: "Username", blankText: "请输入用户名" },
                                    { fieldLabel: "姓名", id: "Farmername", blankText: "请输入真实姓名" },
                                    { fieldLabel: "密码", id: "Password", blankText: "请输入密码" },
                                    { fieldLabel: "联系电话", id: "Phone", blankText: "请输入电话号码" },                                     
                                    { xtype: 'radiogroup',                                  
                                        x: 340,
                                        y: 270,
                                        frame: false,
                                        height: 20,
                                        id: 'rgFarmerGender',
                                        width: 250,
                                        fieldLabel: '性别',
                                        allowBlank: false,
                                        blankText: '请选择您的性别',
                                        items: 
                                        [
                                        {
                                            xtype: 'radiofield',
                                            id: 'rMaleFarmer',
                                            name: 'rGender',
                                            boxLabel: '男'
                                        },
                                        {
                                            xtype: 'radiofield',
                                            id: 'rFemaleFarmer',
                                            name: 'rGender',
                                            boxLabel: '女'
                                        }
                                    ]},
                                    { fieldLabel: "身份证号码", id: "IDnumber", blankText: "请输入身份证号码" },
                                    { fieldLabel: "常住地址", id: "Address", blankText: "请输入地址" }                                                                     
                                    ]
                                }],                                
                                buttons: 
                                [                                
                                {                             
                                    xtype: "button",
                                    text: "确定",                                   
                                    handler: function ()
                                    {           
                                    	var Username = Ext.getCmp("Username").getValue();
                                    	var Farmername = Ext.getCmp("Farmername").getValue();
                                    	var Password = Ext.getCmp("Password").getValue();
                                    	var Idnumber=Ext.getCmp("IDnumber").getValue();
                                    	var Address=Ext.getCmp("Address").getValue();  
                                    	var jsProjectID = Ext.getCmp("ProjectID").getValue();  
                                    	var Sex;  	
                                    	var Phone=Ext.getCmp("Phone").getValue();
                                    	var Permission = "农户";                                   
                                    	// 单选判断
                                		if(Ext.getCmp("rMaleFarmer").getValue())
                                			{Sex="男";
                                			}
                                		
                                		if(Ext.getCmp("rFemaleFarmer").getValue())
                                			{Sex="女";
                                			}
                                		
                                    	Ext.Ajax.request({
                                            //设置提交的地址  
                                            url:'addFarmersInformation.action',  
                                            //设置提交的方式为post  
                                            
                                            params : {
                                				username : "" + Username + "",
                                				farmername : "" + Farmername + "",
                                				password : "" + Password + "",
                                				phone : "" + Phone + "",                          	
                                				sex : "" + Sex + "",
                                				idnumber : "" + Idnumber + "",
                                				address : "" + Address + "",
                                				permission: "" + Permission + "",
                                				projectID: "" + jsProjectID + ""
                                			},
                                            method: 'post',
                                            //网络成功返回  
                                            success: function(form, action) {                                              	
                                            	Ext.Msg.show({
                                            	    title: '农户注册信息',
                                            	    msg: '农户注册成功',
                                            	    width: 300,
                                            	    buttons: Ext.Msg.OK,
                                            	    icon: Ext.window.MessageBox.INFO
                                            	});                                          
                                            },  
                                         //   网络失败返回  
                                            failure: function(form, action) {                                              	                                           	
                                                alert("出错了！");
                                            } 
                                        });                                     	
                                    	winAddFarmer.close();
                                        winPermission.close();
                                        Ext.getCmp("gpUserControl").getStore().reload();
                                    }	
                                },
                                                                                                                                                            
                                {
                                    xtype: "button",
                                    text: "取消",
                                    handler: function ()
                                    {                                    
                                    	winAddFarmer.close();
                                        winPermission.close();
                                    }                                    
                                }      
                                    
                                ]
                            });
                            winAddFarmer.show();
                        }
                        //业主单位
                        else if(Ext.getCmp("cmbPermission").getValue()==2)
                        {
                            var winAddOwner = new Ext.Window(
                            {                            
                                title: "添加业主单位用户",                            
                                width:350,
                                height: 230,                                 
                                modal: true,                               
                                items: [{                                
                                    xtype: "form",                                
                                    id: "frmOwner",
                                    height: "230",
                                    borderStyle: "padding-top:3px",
                                    frame: true,
                                    defaultType: "textfield",
                                    labelAlign: "right",
                                    labelWidth: 60,
                                    defaults: {
                                        allowBlank: false, width: 300
                                    },
                                    items: 
                                    [
                                    { fieldLabel: "用户名", id: "Username", blankText: "请输入用户名" },
                                    { fieldLabel: "密码", id: "Password", blankText: "请输入密码" },
                                    { fieldLabel: "联系电话", id: "Phone", blankText: "请输入电话号码" },                                 
                                    { fieldLabel: "电子邮箱", id: "Email", blankText: "请输入电子邮箱地址" }, 
                                    { fieldLabel: "级别", id: "Level", blankText: "请输入级别" },
                                    { fieldLabel: "部门", id: "Department", blankText: "请输入部门" }                                                       
                                    ]
                                }],                                
                                buttons: 
                                [                                
                                {                             
                                    xtype: "button",
                                    text: "确定",                                   
                                    handler: function ()
                                    {                                    
                                    	var Username = Ext.getCmp("Username").getValue();  	
                                    	var Password = Ext.getCmp("Password").getValue();
                                    	var Phone = Ext.getCmp("Phone").getValue();   
                                    	var Email = Ext.getCmp("Email").getValue(); 	
                                    	var Level = Ext.getCmp("Level").getValue();
                                    	var Department = Ext.getCmp("Department").getValue();
                                    	var Permission = "业主单位";   
                                    	
                                    	Ext.Ajax.request({
                                            //设置提交的地址  
                                            url:'addOwnersUnit.action',  
                                            //设置提交的方式为post  
                                            
                                            params : {
                                				username : "" + Username + "",
                                				password : "" + Password + "",
                                				phone : "" + Phone + "",
                                				department : "" + Department + "",
                                				email : "" + Email + "",
                                				level : "" + Level + "",
                                				permission : "" + Permission + "",
                                				
                                			},
                                            method: 'post',

                                            //网络成功返回  
                                            success: function(form, action) {  
                                            	Ext.Msg.show({
                                            	    title: '业主单位用户注册信息',
                                            	    msg: '业主单位用户注册成功',
                                            	    width: 300,
                                            	    buttons: Ext.Msg.OK,
                                            	    icon: Ext.window.MessageBox.INFO
                                            	});
                                           
                                            },  
                                            //网络失败返回  
                                            failure: function(form, action) {                                              	
                                            	alert("出错了！");                                            	 
                                            } 
                                        });                                     	
                                    	winAddOwner.close();
                                        winPermission.close();    
                                        Ext.getCmp("gpUserControl").getStore().reload();
                                    }	
                                },
                                    
                                                                                                                                                       
                                {
                                    xtype: "button",
                                    text: "取消",
                                    handler: function ()
                                    {                                    
                                    	winAddOwner.close();
                                        winPermission.close();
                                    }                                    
                                }                                       
                                ]
                            });
                            winAddOwner.show();
                        }
                        //行政管理单位
                        else if(Ext.getCmp("cmbPermission").getValue()==3)
                        {
                            var winAddAdmin = new Ext.Window(
                            {                            
                                title: "添加行政管理单位用户",                            
                                width:350,
                                height: 230,                                 
                                modal: true,                               
                                items: [{                                
                                    xtype: "form",                                
                                    id: "frmAdmin",
                                    height: "230",
                                    borderStyle: "padding-top:3px",
                                    frame: true,
                                    defaultType: "textfield",
                                    labelAlign: "right",
                                    labelWidth: 60,
                                    defaults: {
                                        allowBlank: false, width: 300
                                    },
                                    items: 
                                    [
                                    { fieldLabel: "用户名", id: "Username", blankText: "请输入用户名" },
                                    { fieldLabel: "密码", id: "Password", blankText: "请输入密码" },
                                    { fieldLabel: "联系电话", id: "Phone", blankText: "请输入电话号码" },                                                   
                                    { fieldLabel: "电子邮箱", id: "Email", blankText: "请输入电子邮箱地址" }, 
                                    { fieldLabel: "级别", id: "Level", blankText: "请输入级别" },
                                    { fieldLabel: "部门", id: "Department", blankText: "请输入部门" }                                                       
                                    ]
                                }],                                
                                buttons: 
                                [                                
                                {                             
                                    xtype: "button",
                                    text: "确定",                                   
                                    handler: function ()
                                    {
                                    	var Username=Ext.getCmp("Username").getValue();  	
                                    	var Password = Ext.getCmp("Password").getValue();
                                    	var Phone=Ext.getCmp("Phone").getValue();   
                                    	var Email=Ext.getCmp("Email").getValue(); 	
                                    	var Level=Ext.getCmp("Level").getValue();
                                    	var Department=Ext.getCmp("Department").getValue();
                                    	var Permission="行政管理单位";                                       	
                                		
                                    	Ext.Ajax.request({
                                            //设置提交的地址  
                                            url:'addAdministrationUnit.action',  
                                            //设置提交的方式为post  
                                            
                                            params : {
                                				username : "" + Username + "",
                                				password : "" + Password + "",
                                				phone : "" + Phone + "",
//                                				sex : "" + Sex + "",
                                				department : "" + Department + "",
                                				email : "" + Email + "",
                                				level : "" + Level + "",
                                				permission : "" + Permission + "",
                                				
                                			},
                                            method: 'post',

                                            //网络成功返回  
                                            success: function(form, action) {  
                                            	Ext.Msg.show({
                                            	    title: '行政管理单位用户注册信息',
                                            	    msg: '行政管理单位用户注册成功',
                                            	    width: 300,
                                            	    buttons: Ext.Msg.OK,
                                            	    icon: Ext.window.MessageBox.INFO
                                            	});
                                           
                                            },  
                                            //网络失败返回  
                                            failure: function(form, action) {  
                                                alert("出错了！");                                            	 
                                            } 
                                        }); 
                                    	winAddAdmin.close();
                                        winPermission.close();
                                        Ext.getCmp("gpUserControl").getStore().reload();
                                }	
                            },                                                                                                                           
                                {
                                    xtype: "button",
                                    text: "取消",
                                    handler: function ()
                                    {                                    
                                    	winAddAdmin.close();
                                        winPermission.close();                                        
                                    }                                    
                                }                                       
                                ]
                            });
                            winAddAdmin.show();
                        }                    
                    }
                },             
                {             
                    xtype: "button",
                    text: "取消",
                    handler: function () 
                    {                 
                        winPermission.close();
                    }
                }
                ]
            });            
            winPermission.show();break;             
        }
    },
});